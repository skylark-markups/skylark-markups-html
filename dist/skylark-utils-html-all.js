/**
 * skylark-utils-html - The html features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){function n(t,e){if("."!==t[0])return t;var n=e.split("/"),r=t.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}var r=e.define,i=e.require,s="function"==typeof r&&r.amd,a=!s&&"undefined"!=typeof exports;if(!s&&!r){var o={};r=e.define=function(t,e,r){"function"==typeof r?(o[t]={factory:r,deps:e.map(function(e){return n(e,t)}),exports:null},i(t)):o[t]=r},i=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var e=o[t];if(!e.exports){var n=[];e.deps.forEach(function(t){n.push(i(t))}),e.exports=e.factory.apply(window,n)}return e.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(r,i),!s){var u=i("skylark-langx/skylark");a?exports=u:e.skylarkjs=u}}(function(define,require){define("skylark-langx/skylark",[],function(){var t={};return t}),define("skylark-utils/skylark",["skylark-langx/skylark"],function(t){return t}),define("skylark-utils-html/html",["skylark-utils/skylark"],function(t){return t.html=t.html||{}}),define("skylark-utils-dom/skylark",["skylark-langx/skylark"],function(t){return t}),define("skylark-langx/types",[],function(){function t(t){return t&&t.constructor===Array}function e(t){return!f(t)&&!o(t)&&"number"==typeof t.length&&!a(t)}function n(t){return"boolean"==typeof t}function r(t){return"undefined"!=typeof t}function i(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function s(t){var e;for(e in t)if(null!==t[e])return!1;return!0}function a(t){return"function"==_(t)}function o(t){return t&&t instanceof Node}function u(t){return"number"==typeof t}function l(t){return"object"==_(t)}function c(t){return l(t)&&!h(t)&&Object.getPrototypeOf(t)==Object.prototype}function f(t){return"string"==typeof t}function h(t){return t&&t==t.window}function p(t){if(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t.startsWith(e)}}var _=function(){var t={};return"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(e){t["[object "+e+"]"]=e.toLowerCase()}),function(e){return null==e?String(e):t[toString.call(e)]||"object"}}();return{isArray:t,isArrayLike:e,isBoolean:n,isDefined:r,isDocument:i,isEmptyObject:s,isFunction:a,isHtmlNode:o,isNumber:u,isObject:l,isPlainObject:c,isString:f,isSameOrigin:p,isWindow:h,type:_}}),define("skylark-langx/arrays",["./types"],function(t){function e(t){return u.call(t,function(t){return null!=t})}function n(t,e){var n,r,i,s,a;if(t)if(n=t.length,n===s){for(r in t)if(t.hasOwnProperty(r)&&(a=t[r],e.call(a,r,a)===!1))break}else for(i=0;i<n&&(a=t[i],e.call(a,i,a)!==!1);i++);return this}function r(t){if(l(t)){for(var e=[],n=0;n<t.length;n++){var r=t[n];if(l(r))for(var i=0;i<r.length;i++)e.push(r[i]);else e.push(r)}return e}return t}function i(t,e){if(!e)return-1;var n;if(e.indexOf)return e.indexOf(t);for(n=e.length;n--;)if(e[n]===t)return n;return-1}function s(t,e,n){return l(t)?(n||[]).concat(Array.prototype.slice.call(t,e||0)):[t]}function a(t,e){var n,i,s,a=[];if(l(t))for(i=0;i<t.length;i++)n=e.call(t[i],t[i],i),null!=n&&a.push(n);else for(s in t)n=e.call(t[s],t[s],s),null!=n&&a.push(n);return r(a)}function o(t){return u.call(t,function(e,n){return t.indexOf(e)==n})}var u=Array.prototype.filter,l=t.isArrayLike;return{compact:e,first:function(t,e){return e?t.slice(0,e):t[0]},each:n,flatten:r,inArray:i,makeArray:s,map:a,uniq:o}}),define("skylark-langx/objects",["./types"],function(t){function e(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var s=arguments[i],a=t(s),o=a.length,u=0;u<o;u++){var l=a[u];e&&void 0!==n[l]||(n[l]=s[l])}return n}}function n(t){if(!E(t))return[];var e=[];for(var n in t)e.push(n);return e}function r(t){if(E(t))return[];var e=[];for(var n in t)i(t,n)&&e.push(n);return e}function i(t,e){if(!k(e))return null!=t&&g.call(t,e);for(var n=e.length,r=0;r<n;r++){var i=e[r];if(null==t||!g.call(t,i))return!1;t=t[i]}return!!n}function s(t,e){return v(t,e)}function a(t,e){var n=n(e),r=n.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var a=n[s];if(e[a]!==i[a]||!(a in i))return!1}return!0}function o(t,e,n,r){for(var i in e)r&&void 0!==t[i]||(n&&(T(e[i])||k(e[i]))?(T(e[i])&&!T(t[i])&&(t[i]={}),k(e[i])&&!k(t[i])&&(t[i]=[]),o(t[i],e[i],n,r)):void 0!==e[i]&&(t[i]=e[i]));return t}function u(t){var e=m.call(arguments,0),n=e.shift(),r=!1;return b(e[e.length-1])&&(r=e.pop()),{target:n,sources:e,deep:r}}function l(){var t=u.apply(this,arguments);return t.sources.forEach(function(e){o(t.target,e,t.deep,!1)}),t.target}function c(t,e){if(k(t)){var n=t.indexOf(e);n!=-1&&t.splice(n,1)}else if(T(t))for(var r in t)if(t[r]==e){delete t[r];break}return this}function f(t,e,n){k(e)||(e=[e]);var r=e.length;if(!r)return x(n)?n.call(t):n;for(var i=0;i<r;i++){var s=null==t?void 0:t[e[i]];void 0===s&&(s=n,i=r),t=x(s)?s.call(t):s}return t}function h(){var t=u.apply(this,arguments);return t.sources.forEach(function(e){o(t.target,e,t.deep,!0)}),t.target}function p(t){for(var e=_.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function d(t,e){var n;if(void 0===t||null===t)n=t;else if(e&&t.clone)n=t.clone();else if(k(t)){n=[];for(var r=0;r<t.length;r++)n.push(d(t[r]))}else if(T(t)){n={};for(var i in t)n[i]=d(t[i])}else n=t;return n}var v,y,g=Object.prototype.hasOwnProperty,m=Array.prototype.slice,b=t.isBoolean,x=t.isFunction,E=t.isObject,T=t.isPlainObject,k=t.isArray,w="undefined"!=typeof Symbol?Symbol.prototype:null;return v=function(t,e,n,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return!1;if(t!==t)return e!==e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&y(t,e,n,r)},y=function(t,e,n,r){var i=toString.call(t);if(i!==toString.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e;case"[object Symbol]":return w.valueOf.call(t)===w.valueOf.call(e)}var s="[object Array]"===i;if(!s){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,o=e.constructor;if(a!==o&&!(x(a)&&a instanceof a&&x(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===t)return r[u]===e;if(n.push(t),r.push(e),s){if(u=t.length,u!==e.length)return!1;for(;u--;)if(!v(t[u],e[u],n,r))return!1}else{var l,c=Object.keys(t);if(u=c.length,Object.keys(e).length!==u)return!1;for(;u--;)if(l=c[u],void 0===e[l]||!v(t[l],e[l],n,r))return!1}return n.pop(),r.pop(),!0},{allKeys:n,clone:d,defaults:e(n,!0),has:i,isEqual:s,isMatch:a,keys:r,mixin:l,removeItem:c,result:f,safeMixin:h,values:p}}),define("skylark-langx/klass",["./arrays","./objects","./types"],function(t,e,n){var r=t.uniq,i=e.has,s=e.mixin,a=n.isArray,o=n.isDefined,u=function(){function t(t,e,n){var r=t.prototype,i=t.superclass.prototype,s=n&&n.noOverrided;for(var a in e)if("constructor"!==a){var o=e[a];"function"==typeof e[a]?r[a]=o._constructor||s||"function"!=typeof i[a]?o:function(t,e,n){return function(){var t=this.overrided;this.overrided=n;var r=e.apply(this,arguments);return this.overrided=t,r}}(a,o,i[a]):"object"==typeof o&&null!==o&&o.get?Object.defineProperty(r,a,o):r[a]=o}return t}function e(t,e){var n=[];return e.forEach(function(t){if(i(t,"__mixins__"))throw new Error("nested mixins");for(var e=[];t;)e.unshift(t),t=t.superclass;n=n.concat(e)}),n=r(n),n=n.filter(function(e){for(var n=t;n;){if(e===n)return!1;if(i(n,"__mixins__"))for(var r=n.__mixins__,s=0;s<r.length;s++)if(r[s]===e)return!1;n=n.superclass}return!0}),n.length>0&&n}function n(t,e){for(var n=t,r=0;r<e.length;r++){var i=new Function;i.prototype=Object.create(n.prototype),i.__proto__=n,i.superclass=null,s(i.prototype,e[r].prototype),i.prototype.__mixin__=e[r],n=i}return n}return function u(r,i,s,l){a(i)&&(l=s,s=i,i=null),i=i||Object,o(s)&&!a(s)&&(l=s,s=!1);var c=i;s&&(s=e(c,s)),s&&(c=n(c,s));var f=r.constructor;f===Object&&(f=function(){if(this.init)return this.init.apply(this,arguments)});var h=r.klassName||"",p=new Function("return function "+h+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return p._constructor=f,p.prototype=Object.create(c.prototype),p.prototype.constructor=p,p.superclass=i,p.__proto__=c,s&&(p.__mixins__=s),p.partial||(p.partial=function(e,n){return t(this,e,n)}),p.inherit||(p.inherit=function(t,e,n){return u(t,this,e,n)}),p.partial(r,l),p}},l=u();return l}),define("skylark-langx/ArrayStore",["./klass"],function(t){var e=function(t,e){function n(t,e,n){var r,i=0,s=t&&t.length||0,a=[];if(s&&"string"==typeof t&&(t=t.split("")),"string"==typeof e&&(e=cache[e]||buildFn(e)),n)for(;i<s;++i)r=t[i],e.call(n,r,i,t)&&a.push(r);else for(;i<s;++i)r=t[i],e(r,i,t)&&a.push(r);return a}function r(r){var i=n(r,t),s=e&&e.sort;if(s&&i.sort("function"==typeof s?s:function(t,e){for(var n,r=0;n=s[r];r++){var i=t[n.attribute],a=e[n.attribute];if(i=null!=i?i.valueOf():i,a=null!=a?a.valueOf():a,i!=a)return!!n.descending==(null==i||i>a)?-1:1}return 0}),e&&(e.start||e.count)){var a=i.length;i=i.slice(e.start||0,(e.start||0)+(e.count||1/0)),i.total=a}return i}switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var i=t;t=function(t){for(var e in i){var n=i[e];if(n&&n.test){if(!n.test(t[e],t))return!1}else if(n!=t[e])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}return r.matches=t,r},n=function(t){function e(e){t[e]=function(){var i=arguments,s=Deferred.when(t,function(t){return n(Array.prototype[e].apply(t,i))});if("forEach"!==e||r)return s}}if(!t)return t;var r=!!t.then;return r&&(t=Object.delegate(t)),e("forEach"),e("filter"),e("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},r=t({klassName:"ArrayStore",queryEngine:e,idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,e){var n=this.data,r=this.index,i=this.idProperty,s=t[i]=e&&"id"in e?e.id:i in t?t[i]:Math.random();if(s in r){if(e&&e.overwrite===!1)throw new Error("Object already exists");n[r[s]]=t}else r[s]=n.push(t)-1;return s},add:function(t,e){return(e=e||{}).overwrite=!1,this.put(t,e)},remove:function(t){var e=this.index,n=this.data;if(t in e)return n.splice(e[t],1),this.setData(n),!0},query:function(t,e){return n(this.queryEngine(t,e)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var e=0,n=t.length;e<n;e++)this.index[t[e][this.idProperty]]=e},init:function(t){for(var e in t)this[e]=t[e];this.setData(this.data||[])}});return r}),define("skylark-langx/aspect",[],function(){function t(t,e,n,i){var s,a=t[e],o="around"==e;if(o){var u=n(function(){return a.advice(this,arguments)});s={remove:function(){u&&(u=t=n=null)},advice:function(t,e){return u?u.apply(t,e):a.advice(t,e)}}}else s={remove:function(){if(s.advice){var r=s.previous,i=s.next;i||r?(r?r.next=i:t[e]=i,i&&(i.previous=r)):delete t[e],t=n=s.advice=null}},id:r++,advice:n,receiveArguments:i};if(a&&!o)if("after"==e){for(;a.next&&(a=a.next););a.next=s,s.previous=a}else"before"==e&&(t[e]=s,s.next=a,a.previous=s);else t[e]=s;return s}function e(e){return function(i,s,a,o){var u,l=i[s];l&&l.target==i||(i[s]=u=function(){for(var t=r,e=arguments,i=u.before;i;)e=i.advice.apply(this,e)||e,i=i.next;if(u.around)var s=u.around.advice(this,e);for(var a=u.after;a&&a.id<t;){if(a.receiveArguments){var o=a.advice.apply(this,e);s=o===n?s:o}else s=a.advice.call(this,s,e);a=a.next}return s},l&&(u.around={advice:function(t,e){return l.apply(t,e)}}),u.target=i);var c=t(u||l,e,a,o);return a=null,c}}var n,r=0;return{after:e("after"),around:e("around"),before:e("before")}}),define("skylark-langx/funcs",["./objects","./types"],function(t,e){function n(t){return requestAnimationFrame?requestAnimationFrame(t):setTimeoutout(t),this}function r(){}function i(t,e){var n=2 in arguments&&slice.call(arguments,2);if(o(t)){var r=function(){return t.apply(e,n?n.concat(slice.call(arguments)):arguments)};return r}if(u(e))return n?(n.unshift(t[e],t),i.apply(null,n)):i(t[e],t);throw new TypeError("expected function")}function s(t,e){var n;return function(){var r=this,i=arguments,s=function(){n=null,t.apply(r,i)};n&&clearTimeout(n),n=setTimeout(s,e)}}var a=t.mixin,o=e.isFunction,u=e.isString,l=function(){function t(){}return function(e,n){t.prototype=e;var r=new t;return t.prototype=null,n&&a(r,n),r}}();return{debounce:s,delegate:l,defer:n,noop:r,proxy:i,returnTrue:function(){return!0},returnFalse:function(){return!1}}}),define("skylark-langx/Deferred",["./arrays","./funcs","./objects"],function(t,e,n){"use strict";function r(t,e){var n={state:function(){return e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},then:function(t,e,r){return r&&this.progress(r),l(Promise.prototype.then.call(this,t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)},e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)}),n)},progress:function(t){return e[i].push(t),this}};return n.pipe=n.then,l(t,n)}var i=Symbol?Symbol():"__pglisteners",s=Array.prototype.slice,a=e.proxy,o=t.makeArray,u=n.result,l=n.mixin;l(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(t){return this.then(t),this},fail:function(t){return this["catch"](t),this}});var c=function(){var t=this,e=this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n});r(e,t),this[i]=[]};return c.prototype.resolve=function(t){var e=s.call(arguments);return this.resolveWith(null,e)},c.prototype.resolveWith=function(t,e){return e=e?o(e):[],e.__ctx__=t,this._resolve(e),this._resolved=!0,this},c.prototype.progress=function(t){try{return this[i].forEach(function(e){return e(t)})}catch(e){this.reject(e)}return this},c.prototype.reject=function(t){var e=s.call(arguments);return this.rejectWith(null,e)},c.prototype.rejectWith=function(t,e){return e=e?o(e):[],e.__ctx__=t,this._reject(e),this._rejected=!0,this},c.prototype.isResolved=function(){return!!this._resolved},c.prototype.isRejected=function(){return!!this._rejected},c.prototype.then=function(t,e,n){var r=u(this,"promise");return r.then(t,e,n)},c.prototype.done=c.prototype.then,c.all=function(t){return r(Promise.all(t))},c.first=function(t){return r(Promise.race(t))},c.when=function(t,e,n,r){var i=t&&"function"==typeof t.then,s=i&&t instanceof Promise;if(!i)return arguments.length>1?e?e(t):t:(new c).resolve(t);if(!s){var o=new c(t.cancel);t.then(a(o.resolve,o),a(o.reject,o),o.progress),t=o.promise}return e||n||r?t.then(e,n,r):t},c.reject=function(t){var e=new c;return e.reject(t),e.promise},c.resolve=function(t){var e=new c;return e.resolve.apply(e,arguments),e.promise},c.immediate=c.resolve,c}),define("skylark-langx/async",["./Deferred","./arrays"],function(t,e){var n=e.each,r={parallel:function(e,r,i){var s=[];return i=i||null,r=r||[],n(e,function(t,e){s.push(e.apply(i,r))}),t.all(s)},series:function(e,r,i){var s=[],a=new t,o=a.promise;return i=i||null,r=r||[],a.resolve(),n(e,function(t,e){o=o.then(function(){return e.apply(i,r)}),s.push(o)}),t.all(s)},waterful:function(e,r,i){var s=new t,a=s.promise;return i=i||null,r=r||[],s.resolveWith(i,r),n(e,function(t,e){a=a.then(e)}),a}};return r}),define("skylark-langx/Evented",["./klass","./objects","./types"],function(t,e,n){var r=Array.prototype.slice,i=n.isDefined,s=n.isPlainObject,a=n.isFunction,o=n.isString,u=n.isEmptyObject,l=e.mixin,c=t({on:function(t,e,n,r,i,u){var l=this,c=this._hub||(this._hub={});return s(t)?(i=r,each(t,function(t,r){l.on(t,e,n,r,i,u)}),this):(o(e)||a(r)||(i=r,r=n,n=e,e=void 0),a(n)&&(i=r,r=n,n=null),o(t)&&(t=t.split(/\s/)),t.forEach(function(t){(c[t]||(c[t]=[])).push({fn:r,selector:e,data:n,ctx:i,one:u})}),this)},one:function(t,e,n,r,i){return this.on(t,e,n,r,i,1)},trigger:function(t){if(!this._hub)return this;var e=this;o(t)&&(t=new CustomEvent(t)),Object.defineProperty(t,"target",{value:this});var n=r.call(arguments,1);return n=i(n)?[t].concat(n):[t],[t.type||t.name,"all"].forEach(function(r){var i=e._hub[r];if(i){for(var s=i.length,a=!1,o=0;o<s;o++){var u=i[o];t.data?u.data&&(t.data=l({},u.data,t.data)):t.data=u.data||null,u.fn.apply(u.ctx,n),u.one&&(i[o]=null,a=!0)}a&&(e._hub[r]=compact(i))}}),this},listened:function(t){var e=(this._hub||(this._events={}))[t]||[];return e.length>0},listenTo:function(t,e,n,r){if(!t)return this;o(n)&&(n=this[n]),r?t.one(e,n,this):t.on(e,n,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),a=0;a<s.length;a++)if(s[a].obj==t){i=s[a];break}i||s.push(i={obj:t,events:{}});var u=i.events,l=u[e]=u[e]||[];return l.indexOf(n)==-1&&l.push(n),this},listenToOnce:function(t,e,n){return this.listenTo(t,e,n,1)},off:function(t,e){var n=this._hub||(this._hub={});return o(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=n[t],i=[];if(r&&e)for(var s=0,a=r.length;s<a;s++)r[s].fn!==e&&r[s].fn._!==e&&i.push(r[s]);i.length?n[t]=i:delete n[t]}),this},unlistenTo:function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var s=r[i];if(!t||t==s.obj){var a=s.events;for(var o in a)if(!e||e==o){for(var l=a[o],c=0;c<l.length;c++)n&&n!=l[i]||(s.obj.off(o,l[i],this),l[i]=null);l=a[o]=compact(l),u(l)&&(a[o]=null)}u(a)&&(r[i]=null)}}return r=this._listeningTo=compact(r),u(r)&&(this._listeningTo=null),this}});return c}),define("skylark-langx/strings",[],function(){function t(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function e(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(e){return t}}function n(t){return null==t?"":String.prototype.trim.call(t)}function r(t,e,n,r){function i(t,e){if(t.match(/\./)){var n,r=function(t,e){var i=t.pop();return i?e[i]?r(t,n=e[i]):null:n};return r(t.split(".").reverse(),e)}return e[t]}return r=r||window,n=n?proxy(r,n):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,s,a){var o=i(s,e);return a&&(o=i(a,r).call(r,o,s)),n(o,s).toString()})}return{camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},dasherize:t,deserializeValue:e,lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},serializeValue:function(t){return JSON.stringify(t)},substitute:r,trim:n,upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}),define("skylark-langx/Xhr",["./arrays","./Deferred","./Evented","./objects","./funcs","./types"],function(arrays,Deferred,Evented,objects,funcs,types){var each=arrays.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(){var t;return function(e){return t||(t=document.createElement("a")),t.href=e,t.href}}(),Xhr=function(){function mimeToDataType(t){if(t&&(t=t.split(";",2)[0]),t){if(t==htmlType)return"html";if(t==jsonType)return"json";if(scriptTypeRE.test(t))return"script";if(xmlTypeRE.test(t))return"xml"}return"text"}function appendQuery(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function serializeData(t){t.data=t.data||t.query,t.processData&&t.data&&"string"!=type(t.data)&&(t.data=param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=appendQuery(t.url,t.data),t.data=void 0)}function serialize(t,e,n,r){var i,s=isArray(e),a=isPlainObject(e);each(e,function(e,o){i=type(o),r&&(e=n?r:r+"["+(a||"object"==i||"array"==i?e:"")+"]"),!r&&s?t.add(o.name,o.value):"array"==i||!n&&"object"==i?serialize(t,o,n,e):t.add(e,o)})}var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}},param=function(t,e){var n=[];return n.add=function(t,e){isFunction(e)&&(e=e()),null==e&&(e=""),this.push(escape(t)+"="+escape(e))},serialize(n,t,e),n.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(e){error=e}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(t){deferred&&deferred.progress(t,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&contentType!==!1&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var t=this._,e=t.xhr;e&&e.abort()},request:function(t){return this._request(t)},get:function(t){return t=t||{},t.type="GET",this._request(t)},post:function(t){return t=t||{},t.type="POST",this._request(t)},patch:function(t){return t=t||{},t.type="PATCH",this._request(t)},put:function(t){return t=t||{},t.type="PUT",this._request(t)},del:function(t){return t=t||{},t.type="DELETE",this._request(t)},init:function(t){this._={options:t||{}}}});return["request","get","post","put","del","patch"].forEach(function(t){Xhr[t]=function(e,n){var r=new Xhr({url:e});return r[t](n)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return Xhr}),define("skylark-langx/Restful",["./Evented","./objects","./strings","./Xhr"],function(t,e,n,r){var i=e.mixin,s=n.substitute,a=t.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(t){var e=s(this.baseEndpoint,t),n=this.server+this.basePath+e;return void 0!==t[this.idAttribute]&&(n=n+"/"+t[this.idAttribute]),n},_head:function(t){},_get:function(t){return r.get(this.getBaseUrl(t),t)},_post:function(t,e){var n=this.getBaseUrl(t);return e&&(n=n+"/"+e),r.post(n,t)},_put:function(t,e){var n=this.getBaseUrl(t);return e&&(n=n+"/"+e),r.put(n,t)},_delete:function(t){var e=this.getBaseUrl(t);return r.del(e)},_patch:function(t){var e=this.getBaseUrl(t);return r.patch(e,t)},query:function(t){return this._post(t)},retrieve:function(t){return this._get(t)},create:function(t){return this._post(t)},update:function(t){return this._put(t)},"delete":function(t){return this._delete(t)},patch:function(t){return this._patch(t)},init:function(t){i(this,t)}});return a}),define("skylark-langx/Stateful",["./Evented"],function(t){var e=t.inherit({init:function(t,e){var n=t||{};e||(e={}),this.cid=uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var r=result(this,"defaults");n=mixin({},r,n),this.set(n,e),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return clone(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,e,n){if(null==t)return this;var r;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var i=n.unset,s=n.silent,a=[],o=this._changing;this._changing=!0,o||(this._previousAttributes=clone(this.attributes),this.changed={});var u=this.attributes,l=this.changed,c=this._previousAttributes;for(var f in r)e=r[f],isEqual(u[f],e)||a.push(f),isEqual(c[f],e)?delete l[f]:l[f]=e,i?delete u[f]:u[f]=e;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(var h=0;h<a.length;h++)this.trigger("change:"+a[h],this,u[a[h]],n)}if(o)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,mixin({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,mixin({},t,{unset:!0}))},hasChanged:function(t){return null==t?!isEmptyObject(this.changed):void 0!==this.changed[t]},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var r in t){var i=t[r];isEqual(e[r],i)||(n[r]=i)}return!isEmptyObject(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return clone(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},mixin({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=mixin({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,mixin(e,{validationError:n})),!1)}});return e}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./Deferred","./Evented","./funcs","./klass","./objects","./Restful","./Stateful","./strings","./types","./Xhr"],function(t,e,n,r,i,s,a,o,u,l,c,f,h,p,_){"use strict";function d(t,e){var n=new CustomEvent(t,e);return T(n,e)}function v(t,e,n,r){return k(e)?e.call(t,n,r):e}function y(t){var t=t||window.location.href,e=t.split("?"),n={};return e.length>1&&e[1].split("&").forEach(function(t){var e=t.split("=");n[e[0]]=e[1]}),n}function g(t){return parseFloat(t)||0}function m(t){return t._uid||(t._uid=w++)}function b(t){var e=++S+"";return t?t+e:e}function x(){return x}var E=({}.toString,Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter,l.mixin),T=l.safeMixin,k=p.isFunction,w=1,S=0;return E(x,{createEvent:d,funcArg:v,getQueryParams:y,toPixel:g,uid:m,uniqueId:b,URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),E(x,e,r,o,l,h,p,{ArrayStore:n,async:i,Deferred:s,Evented:a,klass:u,Restful:c,Stateful:f,Xhr:_}),t.langx=x}),define("skylark-utils-dom/langx",["skylark-langx/langx"],function(t){return t}),define("skylark-utils-dom/browser",["./skylark","./langx"],function(t,e){function n(t){return c?c+t:t.toLowerCase()}function r(t){return h[t]||t}function i(t){return f[t]||t}function s(){return s}var a,o,u="",l="",c="",f={},h={},p=/^(Webkit|webkit|O|Moz|moz|ms)(.*)$/,_=window.document,d=_.createElement("div"),v=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.matchesSelector,y=d.requestFullscreen||d.webkitRequestFullscreen||d.mozRequestFullScreen||d.msRequestFullscreen,g=(_.exitFullscreen||_.webkitCancelFullScreen||_.mozCancelFullScreen||_.msExitFullscreen,d.style);for(var m in g){var b=m.match(o||p);if(b){o||(a=b[1],o=new RegExp("^("+a+")(.*)$"),l=a,u="-"+a.toLowerCase()+"-",c=a.toLowerCase()),f[e.lowerFirst(b[2])]=m;var x=e.dasherize(b[2]);h[x]=u+x}}return e.mixin(s,{css3PropPrefix:u,isIE:!!/msie/i.exec(window.navigator.userAgent),normalizeStyleProperty:i,normalizeCssProperty:r,normalizeCssEvent:n,matchesSelector:v,requestFullScreen:y,exitFullscreen:y,location:function(){return window.location},support:{}}),d=null,t.browser=s}),define("skylark-utils-dom/styler",["./skylark","./langx"],function(t,e){function n(t,e){return"number"!=typeof e||g[y(t)]?e:e+"px"}function r(t){return t in m?m[t]:m[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function i(t,e){var n=t.className||"",r=n&&void 0!==n.baseVal;return void 0===e?r?n.baseVal:n:void(r?n.baseVal=e:t.className=e)}function s(t,e){return arguments.length<2?!!this.dom.disabled:(t.disabled=e,this)}function a(t){var e,n;return b[t]||(e=document.createElement(t),document.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),b[t]=n),b[t]}function o(t){return x.css(t,"display",""),"none"==x.css(t,"display")&&x.css(t,"display",a(t.nodeName)),this}function u(t){return"none"==x.css(t,"display")||0==x.css(t,"opacity")}function l(t){return x.css(t,"display","none"),this}function c(t,n){if(!n)return this;var s,a=i(t);return s=e.isString(n)?n.split(/\s+/g):n,s.forEach(function(t){var e=r(t);a.match(e)||(a+=(a?" ":"")+t)}),i(t,a),this}function f(t,r,i){if(arguments.length<3){var s,s=getComputedStyle(t,"");if(e.isString(r))return t.style[v(r)]||s.getPropertyValue(y(r));if(e.isArrayLike(r)){var a={};return d.call(r,function(e){a[e]=t.style[v(e)]||s.getPropertyValue(y(e))}),a}}var o="";if("string"==typeof r)i||0===i?o=y(r)+":"+n(r,i):t.style.removeProperty(y(r));else for(key in r)void 0!==r[key]&&(r[key]||0===r[key]?o+=y(key)+":"+n(key,r[key])+";":t.style.removeProperty(y(key)));return t.style.cssText+=";"+o,this}function h(t,e){var n=r(e);return t.className&&t.className.match(n)}function p(t,n){if(n){var s,a=i(t);s=e.isString(n)?n.split(/\s+/g):n,s.forEach(function(t){var e=r(t);a.match(e)&&(a=a.replace(e," "))}),i(t,a.trim())}else i(t,"");return this}function _(t,e,n){var r=this;return e.split(/\s+/g).forEach(function(e){void 0===n&&(n=!r.hasClass(t,e)),n?r.addClass(t,e):r.removeClass(t,e)}),r}var d=(Array.prototype.every,Array.prototype.forEach),v=e.camelCase,y=e.dasherize,g={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},m={},b={},x=function(){return x};return e.mixin(x,{autocssfix:!1,cssHooks:{},addClass:c,className:i,css:f,disabled:s,hasClass:h,hide:l,isInvisible:u,removeClass:p,show:o,toggleClass:_}),t.styler=x}),define("skylark-utils-dom/noder",["./skylark","./langx","./browser","./styler"],function(t,e,n,r){function i(t,n){return e.isArrayLike(t)||(t=[t]),n&&(t=W.call(t,function(t){return t.cloneNode(!0)})),e.flatten(t)}function s(t,e){var n=t.nodeName&&t.nodeName.toLowerCase();return void 0!==e?n===e.toLowerCase():n}
function a(t,e,n){var r=t,s=r.parentNode;if(s)for(var a=i(e,n),r=r.nextSibling,o=0;o<a.length;o++)r?s.insertBefore(a[o],r):s.appendChild(a[o]);return this}function o(t,e,n){for(var r=t,s=i(e,n),a=0;a<s.length;a++)r.appendChild(s[a]);return this}function u(t,e,n){var r=t,s=r.parentNode;if(s)for(var a=i(e,n),o=0;o<a.length;o++)s.insertBefore(a[o],r);return this}function l(t){return s(t,"iframe")?t.contentDocument:t.childNodes}function c(t,e,n){var r=document.createElement(t);if(e)for(var i in e)r.setAttribute(i,e[i]);return n&&o(n,r),r}function f(t){if(t=e.trim(t),F.test(t))return[c(RegExp.$1)];var n=I.test(t)&&RegExp.$1;n in z||(n="*");var r=z[n];return r.innerHTML=""+t,dom=X.call(r.childNodes),dom.forEach(function(t){r.removeChild(t)}),dom}function h(t,e){var n,r=this;return!P||1!==t.nodeType||e?t.cloneNode(e):e?void 0:(n=document.createElement(t.nodeName),each(r.getAttribs(t),function(e){r.setAttrib(n,e.nodeName,r.getAttrib(t,e.nodeName))}),n)}function p(t,e){return m(e,t)}function _(t){return document.createTextNode(t)}function d(){return document}function v(t){for(;t.hasChildNodes();){var e=t.firstChild;t.removeChild(e)}return this}function y(t){if(t===!1)n.exitFullScreen.apply(document);else{if(!t)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.requestFullScreen.apply(t),$=t}}function g(t,n){if(void 0===n)return t.innerHTML;if(this.empty(t),n=n||"",e.isString(n)&&(n=n.replace(G,"<$1></$2>")),e.isString(n)||e.isNumber(n))t.innerHTML=n;else if(e.isArrayLike(n))for(var r=0;r<n.length;r++)t.appendChild(n[r]);else t.appendChild(n)}function m(t,e,n){if(n)return t.parentNode===e;if(document.documentElement.contains)return e.contains(t);for(;t;){if(e===t)return!0;t=t.parentNode}return!1}function b(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function x(t){return t?9==t.nodeType?t:t.ownerDocument:document}function E(t){var e=x(t);return e.defaultView||e.parentWindow}function T(t,e,n){for(var r=t,s=r.firstChild,a=i(e,n),o=0;o<a.length;o++)s?r.insertBefore(a[o],s):r.appendChild(a[o]);return this}function k(t){for(var e=t.offsetParent||document.body;e&&!B.test(e.nodeName)&&"static"==r.css(e,"position");)e=e.offsetParent;return e}function w(t,e){var n=c("div",e);return r.css(n,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2147483647,opacity:.7}),t.appendChild(n),n}function S(t){if(t&&t.parentNode)try{t.parentNode.removeChild(t)}catch(e){console.warn("The node is already removed",e)}return this}function R(t,n){e.isArrayLike(n)||(n=[n]);for(var r=0;r<n.length;r++)t.removeChild(n[r]);return this}function A(t,e){return e.parentNode.replaceChild(t,e),this}function O(t,e){e=e||{};var n,r=this,i=e.text,s=e.style,a=e.time,o=e.callback,u=this.createElement("div",{className:e.className||"throbber",style:s}),l=(w(u,{className:"overlay fade"}),this.createElement("div",{className:"throb"})),c=this.createTextNode(i||""),f=function(){n&&(clearTimeout(n),n=null),u&&(r.remove(u),u=null)},h=function(t){t&&t.text&&u&&(c.nodeValue=t.text)};l.appendChild(c),u.appendChild(l),t.appendChild(u);var p=function(){f(),o&&o()};return a&&(n=setTimeout(p,a)),{remove:f,update:h}}function K(t,e){e(t);for(var n=0,r=t.childNodes.length;n<r;n++)K(t.childNodes[n],e);return this}function C(t){for(var e=t.firstChild,n=t.children.length-1;n>0;n--)if(n>0){var r=t.children[n];t.insertBefore(r,e)}}function N(t,n){e.isString(n)&&(n=this.createFragment(n).firstChild),t.parentNode.insertBefore(n,t),n.appendChild(t)}function j(t,e){var n=X.call(t.childNodes);t.appendChild(e);for(var r=0;r<n.length;r++)e.appendChild(n[r]);return this}function D(t){var e=t.parentNode;if(e){if(this.isDoc(e.parentNode))return;e.parentNode.insertBefore(t,e)}}function L(){return L}var P=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),I=/^\s*<(\w+|!)[^>]*>/,F=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,V=document.createElement("div"),M=document.createElement("table"),U=document.createElement("tbody"),q=document.createElement("tr"),z={tr:U,tbody:M,thead:M,tfoot:M,td:q,th:q,"*":V},B=/^(?:body|html)$/i,W=Array.prototype.map,X=Array.prototype.slice,$=null,G=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;return e.mixin(L,{body:function(){return document.body},clone:h,contents:l,createElement:c,createFragment:f,contains:p,createTextNode:_,doc:d,empty:v,fullScreen:y,html:g,isChildOf:m,isDoc:b,isWindow:e.isWindow,offsetParent:k,ownerDoc:x,ownerWindow:E,after:a,before:u,prepend:T,append:o,remove:S,removeChild:R,replace:A,throb:O,traverse:K,reverse:C,wrapper:N,wrapperInner:j,unwrap:D}),t.noder=L}),define("skylark-utils-dom/css",["./skylark","./langx","./noder"],function(t,e,n){function r(t,r){var i,s={type:"text/css"},a=y++;return r=r||{},r.media&&(s.media=r.media),i=t?n.create("link",e.mixin(s,{rel:"stylesheet",async:!1})):n.createElement("style",s),n.append(v,i),g[a]={id:a,node:i},a}function i(t,e){e||(e={});var n=r(!1,e);return t&&f(n,t),n}function s(t,n){var r=g[t];return e.isNumber(n)?E.call(r,n):e.each(r[x],function(t,e){if(n===e)return E.call(r,t),!1}),this}function a(t){return s(m,t),this}function o(t){if(t===m)throw new Error("The default stylesheet can not be deleted");var e=g[t];return delete g[t],n.remove(e.node),this}function u(t,e,n){return this.insertSheetRule(m,t,e,n)}function l(t){return this.addRules(m,t)}function c(t,e,n,r){if(!e||!n)return-1;var i=g[t];return r=r||i[x].length,d.call(i,e,n,r)}function f(t,r){var i,s=g[t];return i=e.isString(r)?r:p(r),n.append(s.node,n.createTextNode(i)),this}function h(t){return t.startsWith("@")}function p(t){var n=function(t,e,n){return t&&(h(t)?n+=1:e=t+" "+e),{name:e,depth:n}},r=function(t,i,s){var a="",o=h(t);if(h(t))e.isString(i)?a=_.SPACE.repeat(s)+t.trim()+' "'+i.trim()+' ";\n':(a+=_.SPACE.repeat(s)+t.trim()+" {\n",a+=r("",i,s+1),a+=_.SPACE.repeat(s)+" }\n");else if(e.isString(i))a=_.SPACE.repeat(s)+t.trim(),a=o?a+' "'+i.trim()+' ";\n':a+": "+i.trim()+";\n";else if(e.isArray(i))for(var u=0;u<i.length;u++)a+=r(t,i[u],s);else{if(t){a+=_.SPACE.repeat(s)+t.trim()+" {\n";for(var u in i){var l=i[u];e.isString(l)&&(a+=r(u,l,s+1))}a+=_.SPACE.repeat(s)+"}\n"}for(var u in i){var l=i[u];if(!e.isString(l)){var c=n(t,u,s);a+=r(c.name,l,c.depth)}}}return a};return r("",t,0)}function _(){return _}var d,v=document.getElementsByTagName("head")[0],y=0,g={},m=r(),b=g[m],x="cssRules"in b?"cssRules":"rules",E=b.deleteRule||b.removeRule;if(b.insertRule){var T=b.insertRule;d=function(t,e,n){T.call(this,t+"{"+e+"}",n)}}else d=b.addRule;return e.mixin(_,{SPACE:"\t",addRules:l,addSheetRules:f,createStyleSheet:i,deleteSheetRule:s,deleteRule:a,insertRule:u,insertSheetRule:c,removeStyleSheet:o,toString:p}),t.css=_}),define("skylark-utils/css",["skylark-utils-dom/css"],function(t){return t}),define("skylark-utils-css/css",["skylark-utils/skylark","skylark-utils/css"],function(t,e){return e}),define("skylark-utils-css/primitives/beautify-css",[],function(){function t(e,n){function r(){return g=e.charAt(++b),g||""}function i(t){var n=b;return t&&o(),result=e.charAt(b+1)||"",b=n-1,r(),result}function s(t){for(var n=b;r();)if("\\"===g)r();else{if(t.indexOf(g)!==-1)break;if("\n"===g)break}return e.substring(n,b+1)}function a(t){var e=b,n=s(t);return b=e-1,r(),n}function o(){for(var t="";m.test(i());)r(),t+=g;return t}function u(){var t="";for(g&&m.test(g)&&(t=g);m.test(r());)t+=g;return t}function l(t){var n=b,t="/"===i();for(r();r();){if(!t&&"*"===g&&"/"===i()){r();break}if(t&&"\n"===g)return e.substring(n,b)}return e.substring(n,b)+g}function c(t){return e.substring(b-t.length,b).toLowerCase()===t}function f(){for(var t=b+1;t<e.length;t++){var n=e.charAt(t);if("{"===n)return!0;if(";"===n||"}"===n||")"===n)return!1}return!1}function h(){T++,x+=E}function p(){T--,x=x.slice(0,-_)}n=n||{};var _=n.indent_size||4,d=n.indent_char||" ",v=void 0===n.selector_separator_newline||n.selector_separator_newline,y=void 0!==n.end_with_newline&&n.end_with_newline;"string"==typeof _&&(_=parseInt(_,10));var g,m=/^\s+$/,b=-1,x=e.match(/^[\t ]*/)[0],E=new Array(_+1).join(d),T=0,k=0,w={};w["{"]=function(t){w.singleSpace(),S.push(t),w.newLine()},w["}"]=function(t){w.newLine(),S.push(t),w.newLine()},w._lastCharWhitespace=function(){return m.test(S[S.length-1])},w.newLine=function(t){t||w.trim(),S.length&&S.push("\n"),x&&S.push(x)},w.singleSpace=function(){S.length&&!w._lastCharWhitespace()&&S.push(" ")},w.trim=function(){for(;w._lastCharWhitespace();)S.pop()};var S=[];x&&S.push(x);for(var R=!1,A=!1,O="",K="";;){var C=u(),N=""!==C,j=C.indexOf("\n")!==-1,K=O,O=g;if(!g)break;if("/"===g&&"*"===i()){var D=c("");w.newLine(),S.push(l()),w.newLine(),D&&w.newLine(!0)}else if("/"===g&&"/"===i())j||"{"===K||w.trim(),w.singleSpace(),S.push(l()),w.newLine();else if("@"===g){N&&w.singleSpace(),S.push(g);var L=a(": ,;{}()[]/='\"").replace(/\s$/,"");L in t.NESTED_AT_RULE?(k+=1,L in t.CONDITIONAL_GROUP_RULE&&(A=!0)):": ".indexOf(L[L.length-1])>=0&&(r(),L=s(": ").replace(/\s$/,""),S.push(L),w.singleSpace())}else"{"===g?"}"===i(!0)?(o(),r(),w.singleSpace(),S.push("{}")):(h(),w["{"](g),A?(A=!1,R=T>k):R=T>=k):"}"===g?(p(),w["}"](g),R=!1,k&&k--):":"===g?(o(),!R&&!A||c("&")||f()?":"===i()?(r(),S.push("::")):S.push(":"):(S.push(":"),w.singleSpace())):'"'===g||"'"===g?(N&&w.singleSpace(),S.push(s(g))):";"===g?(S.push(g),w.newLine()):"("===g?c("url")?(S.push(g),o(),r()&&(")"!==g&&'"'!==g&&"'"!==g?S.push(s(")")):b--)):(N&&w.singleSpace(),S.push(g),o()):")"===g?S.push(g):","===g?(S.push(g),o(),!R&&v?w.newLine():w.singleSpace()):"]"===g?S.push(g):"["===g?(N&&w.singleSpace(),S.push(g)):"="===g?(o(),S.push(g)):(N&&w.singleSpace(),S.push(g))}var P=S.join("").replace(/[\r\n\t ]+$/,"");return y&&(P+="\n"),P}return t.NESTED_AT_RULE={"@page":!0,"@font-face":!0,"@keyframes":!0,"@media":!0,"@supports":!0,"@document":!0},t.CONDITIONAL_GROUP_RULE={"@media":!0,"@supports":!0,"@document":!0},{css_beautify:t}}),define("skylark-utils-css/beautify",["./css","./primitives/beautify-css"],function(t,e){return t.beautify=e.css_beautify}),define("skylark-utils-dom/finder",["./skylark","./langx","./browser","./noder"],function(t,e,n,r,s){function a(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function o(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function u(t,n,r){for(var i=r&&e.isString(r);t=t.parentNode;){if(m(t,n))return t;if(r)if(i){if(m(t,r))break}else if(t==r)break}return null}function l(t,n,r){for(var i=[],s=r&&e.isString(r);(t=t.parentNode)&&9!==t.nodeType;)if(i.push(t),r)if(s){if(m(t,r))break}else if(t==r)break;return n&&(i=S.filter(i,n)),i}function c(t,e){return e=e||r.doc(),e.getElementById(t)}function f(t,e){for(var n=t.childNodes,r=[],i=0;i<n.length;i++){var t=n[i];1==t.nodeType&&r.push(t)}return e&&(r=S.filter(r,e)),r}function h(t,e){for(;t&&!m(t,e);)t=t.parentNode;return t}function p(t,e){try{return A.call(t.querySelectorAll(e))}catch(n){}return S.query(t,e)}function _(t,e){try{return t.querySelector(e)}catch(n){}var r=S.query(t,e);return r.length>0?r[0]:null}function d(t,e){return e||(e=t,t=document.body),m(t,e)?t:_(t,e)}function v(t,e){return e||(e=t,t=document.body),p(t,e)}function y(t,e,n){for(var r=t.childNodes,i=r[0];i;){if(1==i.nodeType){if(!e||m(i,e))return i;if(n)break}i=i.nextSibling}return null}function g(t,e,n){for(var r=t.childNodes,i=r[r.length-1];i;){if(1==i.nodeType){if(!e||m(i,e))return i;if(n)break}i=i.previousSibling}return null}function m(t,n){if(!n||!t||1!==t.nodeType)return!1;if(e.isString(n)){try{return O.call(t,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(r){}return S.match(t,n)}return e.isArrayLike(n)?e.inArray(t,n)>-1:e.isPlainObject(n)?S.check(t,n):t===n}function b(t,e,n){for(var r=t.nextSibling;r;){if(1==r.nodeType){if(!e||m(r,e))return r;if(n)break}r=r.nextSibling}return null}function x(t,e){for(var n=t.nextSibling,r=[];n;)1==n.nodeType&&(e&&!m(n,e)||r.push(n)),n=n.nextSibling;return r}function E(t,e){var n=t.parentNode;return!n||e&&!m(n,e)?null:n}function T(t,e,n){for(var r=t.previousSibling;r;){if(1==r.nodeType){if(!e||m(r,e))return r;if(n)break}r=r.previousSibling}return null}function k(t,e){for(var n=t.previousSibling,r=[];n;)1==n.nodeType&&(e&&!m(n,e)||r.push(n)),n=n.previousSibling;return r}function w(t,e){for(var n=t.parentNode.firstChild,r=[];n;)1==n.nodeType&&n!==t&&(e&&!m(n,e)||r.push(n)),n=n.nextSibling;return r}var S={},R=Array.prototype.filter,A=Array.prototype.slice,O=n.matchesSelector;(function(){function t(t,s,a,u,c,h,p,_,d,v,y,g,m,b,x,E){if((s||n===-1)&&(e.expressions[++n]=[],r=-1,s))return"";if(a||u||r===-1){a=a||" ";var T=e.expressions[n];i&&T[r]&&(T[r].reverseCombinator=l(a)),T[++r]={combinator:a,tag:"*"}}var k=e.expressions[n][r];if(c)k.tag=c.replace(o,"");else if(h)k.id=h.replace(o,"");else if(p)p=p.replace(o,""),k.classList||(k.classList=[]),k.classes||(k.classes=[]),k.classList.push(p),k.classes.push({value:p,regexp:new RegExp("(^|\\s)"+f(p)+"(\\s|$)")});else if(m)E=E||x,E=E?E.replace(o,""):null,k.pseudos||(k.pseudos=[]),k.pseudos.push({key:m.replace(o,""),value:E,type:1==g.length?"class":"element"});else if(_){_=_.replace(o,""),y=(y||"").replace(o,"");var w,S;switch(d){case"^=":S=new RegExp("^"+f(y));break;case"$=":S=new RegExp(f(y)+"$");break;case"~=":S=new RegExp("(^|\\s)"+f(y)+"(\\s|$)");break;case"|=":S=new RegExp("^"+f(y)+"(-|$)");break;case"=":w=function(t){return y==t};break;case"*=":w=function(t){return t&&t.indexOf(y)>-1};break;case"!=":w=function(t){return y!=t};break;default:w=function(t){return!!t}}""==y&&/^[*$^]=$/.test(d)&&(w=function(){return!1}),w||(w=function(t){return t&&S.test(t)}),k.attributes||(k.attributes=[]),k.attributes.push({key:_,operator:d,value:y,test:w})}return""}var e,n,r,i,s={},a={},o=/\\/g,u=function(r,o){if(null==r)return null;if(r.Slick===!0)return r;r=(""+r).replace(/^\s+|\s+$/g,""),i=!!o;var l=i?a:s;if(l[r])return l[r];for(e={Slick:!0,expressions:[],raw:r,reverse:function(){return u(this.raw,!0)}},n=-1;r!=(r=r.replace(h,t)););return e.length=e.expressions.length,l[e.raw]=i?c(e):e},l=function(t){return"!"===t?" ":" "===t?"!":/^!/.test(t)?t.replace(/^!/,""):"!"+t},c=function(t){for(var e=t.expressions,n=0;n<e.length;n++){for(var r=e[n],i={parts:[],tag:"*",combinator:l(r[0].combinator)},s=0;s<r.length;s++){var a=r[s];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}r.reverse().push(i)}return t},f=function(){var t=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,e="\\";return function(n){return n.replace(t,e)}}(),h=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+f(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),p=this.Slick||{};p.parse=function(t){return u(t)},p.escapeRegExp=f,this.Slick||(this.Slick=p)}).apply(S);var K=/^(?:input|select|textarea|button)$/i,C=/^h\d$/i,A=Array.prototype.slice;S.parseSelector=S.Slick.parse;var N=S.pseudos={button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},checked:function(t){return!!t.checked},contains:function(t,e,n,r){if($(this).text().indexOf(r)>-1)return this},disabled:function(t){return!!t.disabled},enabled:function(t){return!t.disabled},eq:function(t,e,n,r){return e==r},even:function(t,e,n,r){return e%2===0},focus:function(t){return document.activeElement===t&&(t.href||t.type||t.tabindex)},first:function(t,e){return 0===e},gt:function(t,e,n,r){return e>r},has:function(t,e,n,r){return d(t,r)},header:function(t){return C.test(t.nodeName)},hidden:function(t){return!S.pseudos.visible(t)},input:function(t){return K.test(t.nodeName)},last:function(t,e,n){return e===n.length-1},lt:function(t,e,n,r){return e<r},not:function(t,e,n,r){return!m(t,r)},odd:function(t,e,n,r){return e%2===1},parent:function(t){return!!t.parentNode},selected:function(t){return!!t.selected},text:function(t){return"text"===t.type},visible:function(t){return t.offsetWidth&&t.offsetWidth}};["first","eq","last"].forEach(function(t){N[t].isArrayFilter=!0}),N.nth=N.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})N[i]=a(i);for(i in{submit:!0,reset:!0})N[i]=o(i);S.divide=function(t){var e,n,r,i,s,a="",o=[];if((n=t.id)&&(a+="#"+n),r=t.classes)for(var u=r.length;u--;)a+="."+r[u].value;if(i=t.attributes)for(var u=0;u<i.length;u++)a+=i[u].operator?"["+i[u].key+i[u].operator+JSON.stringify(i[u].value)+"]":"["+i[u].key+"]";if(s=t.pseudos)for(u=s.length;u--;)part=s[u],this.pseudos[part.key]?o.push(part):void 0!==part.value&&(a+=":"+part.key+"("+JSON.stringify(part));return(e=t.tag)&&"*"!==e&&(a=e.toUpperCase()+a),a||(a="*"),{nativeSelector:a,customPseudos:o}},S.check=function(t,e,n,r,i){var s,a,o,u,l,c,f,h,p;if(!i){if(s=e.tag){var _=t.nodeName.toUpperCase();if("*"==s){if(_<"@")return!1}else if(_!=(s||"").toUpperCase())return!1}if((a=e.id)&&t.getAttribute("id")!=a)return!1;if(o=e.classes)for(c=o.length;c--;)if(h=t.getAttribute("class"),!h||!o[c].regexp.test(h))return!1;if(u=e.attributes)for(c=u.length;c--;)if(f=u[c],f.operator?!f.test(t.getAttribute(f.key)):!t.hasAttribute(f.key))return!1}if(l=e.pseudos)for(c=l.length;c--;)if(f=l[c],p=this.pseudos[f.key]){if((i&&p.isArrayFilter||!i&&!p.isArrayFilter)&&!p(t,n,r,f.value))return!1}else if(!i&&!O.call(t,f.key))return!1;return!0},S.match=function(t,n){var r;if(r=e.isString(n)?S.Slick.parse(n):n,!r)return!0;var i,s,a=r.expressions,o=0;for(i=0;s=a[i];i++)if(1==s.length){var u=s[0];if(this.check(t,u))return!0;o++}if(o==r.length)return!1;var l,c=this.query(document,r);for(i=0;l=c[i++];)if(l===t)return!0;return!1},S.filterSingle=function(t,e){var n=R.call(t,function(n,r){return S.check(n,e,r,t,!1)});return n=R.call(n,function(t,r){return S.check(t,e,r,n,!0)})},S.filter=function(t,n){var r;if(!e.isString(n))return S.filterSingle(t,n);r=S.Slick.parse(n);var i,s,a=r.expressions,o=[];for(i=0;s=a[i];i++){if(1!=s.length)throw new Error("not supported selector:"+n);var u=s[0],l=S.filterSingle(t,u);o=e.uniq(o.concat(l))}return o},S.combine=function(t,e){var n,r=e.combinator,i=e,s=[];switch(r){case">":s=f(t,i);break;case"+":n=b(t,i,!0),n&&s.push(n);break;case"^":n=y(t,i,!0),n&&s.push(n);break;case"~":s=x(t,i);break;case"++":var a=T(t,i,!0),o=b(t,i,!0);a&&s.push(a),o&&s.push(o);break;case"~~":s=w(t,i);break;case"!":s=l(t,i);break;case"!>":n=E(t,i),n&&s.push(n);break;case"!+":s=T(t,i,!0);break;case"!^":n=g(t,i,!0),n&&s.push(n);break;case"!~":s=k(t,i);break;default:var u=this.divide(e);if(s=A.call(t.querySelectorAll(u.nativeSelector)),u.customPseudos)for(var c=u.customPseudos.length-1;c>=0;c--)s=R.call(s,function(t,e){return S.check(t,{pseudos:[u.customPseudos[c]]},e,s,!1)}),s=R.call(s,function(t,e){return S.check(t,{pseudos:[u.customPseudos[c]]},e,s,!0)})}return s},S.query=function(t,n,r){for(var i,s,a=this.Slick.parse(n),o=[],u=a.expressions,l=0;i=u[l];l++){for(var c,f=[t],h=0;s=i[h];h++)c=e.map(f,function(t,e){return S.combine(t,s)}),c&&(f=c);c&&(o=o.concat(c))}return o};var j=function(){return j};return e.mixin(j,{ancestor:u,ancestors:l,byId:c,children:f,closest:h,descendant:_,descendants:p,find:d,findAll:v,firstChild:y,lastChild:g,matches:m,nextSibling:b,nextSiblings:x,parent:E,previousSibling:T,previousSiblings:k,pseudos:S.pseudos,siblings:w}),t.finder=j}),define("skylark-utils-dom/scripter",["./skylark","./langx","./noder","./finder"],function(t,e,n,r){function i(){return i}var s=document.getElementsByTagName("head")[0],a={},o={},u=0;return e.mixin(i,{loadJavaScript:function(t,e,n){var r=a[t];if(r||(r=a[t]={state:0,loadedCallbacks:[],errorCallbacks:[]}),r.loadedCallbacks.push(e),r.errorCallbacks.push(n),1===r.state)r.node.onload();else if(r.state===-1)r.node.onerror();else{var i=r.node=document.createElement("script"),l=r.id=u++;i.type="text/javascript",i.async=!1,i.defer=!1,startTime=(new Date).getTime(),s.appendChild(i),i.onload=function(){r.state=1;for(var t=r.loadedCallbacks,e=t.length;e--;)t[e]();r.loadedCallbacks=[],r.errorCallbacks=[]},i.onerror=function(){r.state=-1;for(var t=r.errorCallbacks,e=t.length;e--;)t[e]();r.loadedCallbacks=[],r.errorCallbacks=[]},i.src=t,o[l]=i}return r.id},deleteJavaScript:function(t){var e=o[t];if(e){var r=e.src;n.remove(e),delete o[t],delete a[r]}}}),t.scripter=i}),define("skylark-utils/scripter",["skylark-utils-dom/scripter"],function(t){return t}),define("skylark-utils-js/js",["skylark-utils/skylark","skylark-utils/scripter"],function(t,e){return e}),define("skylark-utils-js/primitives/beautify-js",[],function(){function t(t,e){for(var n=0;n<e.length;n+=1)if(e[n]===t)return!0;return!1}function e(t){return t.replace(/^\s+|\s+$/g,"")}function n(t,e){"use strict";var n=new r(t,e);return n.beautify()}function r(n,r){"use strict";function i(t,e){var n=0;t&&(n=t.indentation_level,!q.just_added_newline()&&t.line_indent_level>n&&(n=t.line_indent_level));var r={mode:e,parent:t,last_text:t?t.last_text:"",last_word:t?t.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:n,line_indent_level:t?t.line_indent_level:n,start_line_index:q.get_line_number(),ternary_depth:0};return r}function o(t){var e=t.newlines,n=tt.keep_array_indentation&&y(H.mode);if(n)for(r=0;r<e;r+=1)f(r>0);else if(tt.max_preserve_newlines&&e>tt.max_preserve_newlines&&(e=tt.max_preserve_newlines),tt.preserve_newlines&&t.newlines>1){f();for(var r=1;r<e;r+=1)f(!0)}W=t,Y[W.type]()}function l(t){t=t.replace(/\x0d/g,"");for(var e=[],n=t.indexOf("\n");n!==-1;)e.push(t.substring(0,n)),t=t.substring(n+1),n=t.indexOf("\n");return t.length&&e.push(t),e}function c(t){if(t=void 0!==t&&t,!q.just_added_newline())if(tt.preserve_newlines&&W.wanted_newline||t)f(!1,!0);else if(tt.wrap_line_length){var e=q.current_line.get_character_count()+W.text.length+(q.space_before_token?1:0);e>=tt.wrap_line_length&&f(!1,!0)}}function f(t,e){if(!e&&";"!==H.last_text&&","!==H.last_text&&"="!==H.last_text&&"TK_OPERATOR"!==X)for(;H.mode===u.Statement&&!H.if_block&&!H.do_block;)m();q.add_new_line(t)&&(H.multiline_frame=!0)}function h(){q.just_added_newline()&&(tt.keep_array_indentation&&y(H.mode)&&W.wanted_newline?(q.current_line.push(W.whitespace_before),q.space_before_token=!1):q.set_indent(H.indentation_level)&&(H.line_indent_level=H.indentation_level))}function p(t){t=t||W.text,h(),q.add_token(t)}function _(){H.indentation_level+=1}function d(){H.indentation_level>0&&(!H.parent||H.indentation_level>H.parent.indentation_level)&&(H.indentation_level-=1)}function v(t){H?(J.push(H),Q=H):Q=i(null,t),H=i(Q,t)}function y(t){return t===u.ArrayLiteral}function g(e){return t(e,[u.Expression,u.ForInitializer,u.Conditional])}function m(){J.length>0&&(Q=H,H=J.pop(),Q.mode===u.Statement&&q.remove_redundant_indentation(Q))}function b(){return H.parent.mode===u.ObjectLiteral&&H.mode===u.Statement&&(":"===H.last_text&&0===H.ternary_depth||"TK_RESERVED"===X&&t(H.last_text,["get","set"]))}function x(){return!!("TK_RESERVED"===X&&t(H.last_text,["var","let","const"])&&"TK_WORD"===W.type||"TK_RESERVED"===X&&"do"===H.last_text||"TK_RESERVED"===X&&"return"===H.last_text&&!W.wanted_newline||"TK_RESERVED"===X&&"else"===H.last_text&&("TK_RESERVED"!==W.type||"if"!==W.text)||"TK_END_EXPR"===X&&(Q.mode===u.ForInitializer||Q.mode===u.Conditional)||"TK_WORD"===X&&H.mode===u.BlockStatement&&!H.in_case&&"--"!==W.text&&"++"!==W.text&&"TK_WORD"!==W.type&&"TK_RESERVED"!==W.type||H.mode===u.ObjectLiteral&&(":"===H.last_text&&0===H.ternary_depth||"TK_RESERVED"===X&&t(H.last_text,["get","set"])))&&(v(u.Statement),_(),"TK_RESERVED"===X&&t(H.last_text,["var","let","const"])&&"TK_WORD"===W.type&&(H.declaration_statement=!0),b()||c("TK_RESERVED"===W.type&&t(W.text,["do","for","if","while"])),!0)}function E(t,n){for(var r=0;r<t.length;r++){var i=e(t[r]);if(i.charAt(0)!==n)return!1}return!0}function T(t,e){for(var n,r=0,i=t.length;r<i;r++)if(n=t[r],n&&0!==n.indexOf(e))return!1;return!0}function k(e){return t(e,["case","return","do","if","throw","else"])}function w(t){var e=z+(t||0);return e<0||e>=et.length?null:et[e]}function S(){x();var e=u.Expression;if("["===W.text){if("TK_WORD"===X||")"===H.last_text)return"TK_RESERVED"===X&&t(H.last_text,B.line_starters)&&(q.space_before_token=!0),v(e),p(),_(),void(tt.space_in_paren&&(q.space_before_token=!0));e=u.ArrayLiteral,y(H.mode)&&("["!==H.last_text&&(","!==H.last_text||"]"!==$&&"}"!==$)||tt.keep_array_indentation||f())}else"TK_RESERVED"===X&&"for"===H.last_text?e=u.ForInitializer:"TK_RESERVED"===X&&t(H.last_text,["if","while"])&&(e=u.Conditional);";"===H.last_text||"TK_START_BLOCK"===X?f():"TK_END_EXPR"===X||"TK_START_EXPR"===X||"TK_END_BLOCK"===X||"."===H.last_text?c(W.wanted_newline):"TK_RESERVED"===X&&"("===W.text||"TK_WORD"===X||"TK_OPERATOR"===X?"TK_RESERVED"===X&&("function"===H.last_word||"typeof"===H.last_word)||"*"===H.last_text&&"function"===$?tt.space_after_anon_function&&(q.space_before_token=!0):"TK_RESERVED"!==X||!t(H.last_text,B.line_starters)&&"catch"!==H.last_text||tt.space_before_conditional&&(q.space_before_token=!0):q.space_before_token=!0,"("===W.text&&("TK_EQUALS"!==X&&"TK_OPERATOR"!==X||b()||c()),v(e),p(),tt.space_in_paren&&(q.space_before_token=!0),_()}function R(){for(;H.mode===u.Statement;)m();H.multiline_frame&&c("]"===W.text&&y(H.mode)&&!tt.keep_array_indentation),tt.space_in_paren&&("TK_START_EXPR"!==X||tt.space_in_empty_paren?q.space_before_token=!0:(q.trim(),q.space_before_token=!1)),"]"===W.text&&tt.keep_array_indentation?(p(),m()):(m(),p()),q.remove_redundant_indentation(Q),H.do_while&&Q.mode===u.Conditional&&(Q.mode=u.Expression,H.do_block=!1,H.do_while=!1)}function A(){var e=w(1),n=w(2);v(n&&(":"===n.text&&t(e.type,["TK_STRING","TK_WORD","TK_RESERVED"])||t(e.text,["get","set"])&&t(n.type,["TK_WORD","TK_RESERVED"]))?t($,["class","interface"])?u.BlockStatement:u.ObjectLiteral:u.BlockStatement);var r=!e.comments_before.length&&"}"===e.text,i=r&&"function"===H.last_word&&"TK_END_EXPR"===X;"expand"===tt.brace_style||"none"===tt.brace_style&&W.wanted_newline?"TK_OPERATOR"!==X&&(i||"TK_EQUALS"===X||"TK_RESERVED"===X&&k(H.last_text)&&"else"!==H.last_text)?q.space_before_token=!0:f(!1,!0):"TK_OPERATOR"!==X&&"TK_START_EXPR"!==X?"TK_START_BLOCK"===X?f():q.space_before_token=!0:y(Q.mode)&&","===H.last_text&&("}"===$?q.space_before_token=!0:f()),p(),_()}function O(){for(;H.mode===u.Statement;)m();var t="TK_START_BLOCK"===X;"expand"===tt.brace_style?t||f():t||(y(H.mode)&&tt.keep_array_indentation?(tt.keep_array_indentation=!1,f(),tt.keep_array_indentation=!0):f()),m(),p()}function K(){if("TK_RESERVED"===W.type&&H.mode!==u.ObjectLiteral&&t(W.text,["set","get"])&&(W.type="TK_WORD"),"TK_RESERVED"===W.type&&H.mode===u.ObjectLiteral){var e=w(1);":"==e.text&&(W.type="TK_WORD")}if(x()||!W.wanted_newline||g(H.mode)||"TK_OPERATOR"===X&&"--"!==H.last_text&&"++"!==H.last_text||"TK_EQUALS"===X||!tt.preserve_newlines&&"TK_RESERVED"===X&&t(H.last_text,["var","let","const","set","get"])||f(),H.do_block&&!H.do_while){if("TK_RESERVED"===W.type&&"while"===W.text)return q.space_before_token=!0,p(),q.space_before_token=!0,void(H.do_while=!0);f(),H.do_block=!1}if(H.if_block)if(H.else_block||"TK_RESERVED"!==W.type||"else"!==W.text){for(;H.mode===u.Statement;)m();H.if_block=!1,H.else_block=!1}else H.else_block=!0;if("TK_RESERVED"===W.type&&("case"===W.text||"default"===W.text&&H.in_case_statement))return f(),(H.case_body||tt.jslint_happy)&&(d(),H.case_body=!1),p(),H.in_case=!0,void(H.in_case_statement=!0);if("TK_RESERVED"===W.type&&"function"===W.text&&((t(H.last_text,["}",";"])||q.just_added_newline()&&!t(H.last_text,["[","{",":","=",","]))&&(q.just_added_blankline()||W.comments_before.length||(f(),f(!0))),"TK_RESERVED"===X||"TK_WORD"===X?"TK_RESERVED"===X&&t(H.last_text,["get","set","new","return","export"])?q.space_before_token=!0:"TK_RESERVED"===X&&"default"===H.last_text&&"export"===$?q.space_before_token=!0:f():"TK_OPERATOR"===X||"="===H.last_text?q.space_before_token=!0:(H.multiline_frame||!g(H.mode)&&!y(H.mode))&&f()),"TK_COMMA"!==X&&"TK_START_EXPR"!==X&&"TK_EQUALS"!==X&&"TK_OPERATOR"!==X||b()||c(),"TK_RESERVED"===W.type&&t(W.text,["function","get","set"]))return p(),void(H.last_word=W.text);if(Z="NONE","TK_END_BLOCK"===X?"TK_RESERVED"===W.type&&t(W.text,["else","catch","finally"])?"expand"===tt.brace_style||"end-expand"===tt.brace_style||"none"===tt.brace_style&&W.wanted_newline?Z="NEWLINE":(Z="SPACE",q.space_before_token=!0):Z="NEWLINE":"TK_SEMICOLON"===X&&H.mode===u.BlockStatement?Z="NEWLINE":"TK_SEMICOLON"===X&&g(H.mode)?Z="SPACE":"TK_STRING"===X?Z="NEWLINE":"TK_RESERVED"===X||"TK_WORD"===X||"*"===H.last_text&&"function"===$?Z="SPACE":"TK_START_BLOCK"===X?Z="NEWLINE":"TK_END_EXPR"===X&&(q.space_before_token=!0,Z="NEWLINE"),"TK_RESERVED"===W.type&&t(W.text,B.line_starters)&&")"!==H.last_text&&(Z="else"===H.last_text||"export"===H.last_text?"SPACE":"NEWLINE"),"TK_RESERVED"===W.type&&t(W.text,["else","catch","finally"]))if("TK_END_BLOCK"!==X||"expand"===tt.brace_style||"end-expand"===tt.brace_style||"none"===tt.brace_style&&W.wanted_newline)f();else{q.trim(!0);var n=q.current_line;"}"!==n.last()&&f(),q.space_before_token=!0}else"NEWLINE"===Z?"TK_RESERVED"===X&&k(H.last_text)?q.space_before_token=!0:"TK_END_EXPR"!==X?"TK_START_EXPR"===X&&"TK_RESERVED"===W.type&&t(W.text,["var","let","const"])||":"===H.last_text||("TK_RESERVED"===W.type&&"if"===W.text&&"else"===H.last_text?q.space_before_token=!0:f()):"TK_RESERVED"===W.type&&t(W.text,B.line_starters)&&")"!==H.last_text&&f():H.multiline_frame&&y(H.mode)&&","===H.last_text&&"}"===$?f():"SPACE"===Z&&(q.space_before_token=!0);p(),H.last_word=W.text,"TK_RESERVED"===W.type&&"do"===W.text&&(H.do_block=!0),"TK_RESERVED"===W.type&&"if"===W.text&&(H.if_block=!0)}function C(){for(x()&&(q.space_before_token=!1);H.mode===u.Statement&&!H.if_block&&!H.do_block;)m();p()}function N(){x()?q.space_before_token=!0:"TK_RESERVED"===X||"TK_WORD"===X?q.space_before_token=!0:"TK_COMMA"===X||"TK_START_EXPR"===X||"TK_EQUALS"===X||"TK_OPERATOR"===X?b()||c():f(),p()}function j(){x(),H.declaration_statement&&(H.declaration_assignment=!0),q.space_before_token=!0,p(),q.space_before_token=!0}function D(){return H.declaration_statement?(g(H.parent.mode)&&(H.declaration_assignment=!1),p(),void(H.declaration_assignment?(H.declaration_assignment=!1,f(!1,!0)):q.space_before_token=!0)):(p(),void(H.mode===u.ObjectLiteral||H.mode===u.Statement&&H.parent.mode===u.ObjectLiteral?(H.mode===u.Statement&&m(),f()):q.space_before_token=!0))}function L(){if(x(),"TK_RESERVED"===X&&k(H.last_text))return q.space_before_token=!0,void p();if("*"===W.text&&"TK_DOT"===X)return void p();if(":"===W.text&&H.in_case)return H.case_body=!0,_(),p(),f(),void(H.in_case=!1);if("::"===W.text)return void p();!W.wanted_newline||"--"!==W.text&&"++"!==W.text||f(!1,!0),"TK_OPERATOR"===X&&c();var e=!0,n=!0;t(W.text,["--","++","!","~"])||t(W.text,["-","+"])&&(t(X,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||t(H.last_text,B.line_starters)||","===H.last_text)?(e=!1,n=!1,";"===H.last_text&&g(H.mode)&&(e=!0),"TK_RESERVED"===X||"TK_END_EXPR"===X?e=!0:"TK_OPERATOR"===X&&(e=t(W.text,["--","-"])&&t(H.last_text,["--","-"])||t(W.text,["++","+"])&&t(H.last_text,["++","+"])),H.mode!==u.BlockStatement&&H.mode!==u.Statement||"{"!==H.last_text&&";"!==H.last_text||f()):":"===W.text?0===H.ternary_depth?e=!1:H.ternary_depth-=1:"?"===W.text?H.ternary_depth+=1:"*"===W.text&&"TK_RESERVED"===X&&"function"===H.last_text&&(e=!1,n=!1),q.space_before_token=q.space_before_token||e,p(),q.space_before_token=n}function P(){var t,n=l(W.text),r=!1,i=!1,s=W.whitespace_before,a=s.length;for(f(!1,!0),n.length>1&&(E(n.slice(1),"*")?r=!0:T(n.slice(1),s)&&(i=!0)),p(n[0]),t=1;t<n.length;t++)f(!1,!0),
r?p(" "+e(n[t])):i&&n[t].length>a?p(n[t].substring(a)):q.add_token(n[t]);f(!1,!0)}function I(){q.space_before_token=!0,p(),q.space_before_token=!0}function F(){W.wanted_newline?f(!1,!0):q.trim(!0),q.space_before_token=!0,p(),f(!1,!0)}function V(){x(),"TK_RESERVED"===X&&k(H.last_text)?q.space_before_token=!0:c(")"===H.last_text&&tt.break_chained_methods),p()}function M(){p(),"\n"===W.text[W.text.length-1]&&f()}function U(){for(;H.mode===u.Statement;)m()}var q,z,B,W,X,$,G,H,Q,J,Z,Y,tt,et=[],nt="";for(Y={TK_START_EXPR:S,TK_END_EXPR:R,TK_START_BLOCK:A,TK_END_BLOCK:O,TK_WORD:K,TK_RESERVED:K,TK_SEMICOLON:C,TK_STRING:N,TK_EQUALS:j,TK_OPERATOR:L,TK_COMMA:D,TK_BLOCK_COMMENT:P,TK_INLINE_COMMENT:I,TK_COMMENT:F,TK_DOT:V,TK_UNKNOWN:M,TK_EOF:U},r=r?r:{},tt={},void 0!==r.braces_on_own_line&&(tt.brace_style=r.braces_on_own_line?"expand":"collapse"),tt.brace_style=r.brace_style?r.brace_style:tt.brace_style?tt.brace_style:"collapse","expand-strict"===tt.brace_style&&(tt.brace_style="expand"),tt.indent_size=r.indent_size?parseInt(r.indent_size,10):4,tt.indent_char=r.indent_char?r.indent_char:" ",tt.preserve_newlines=void 0===r.preserve_newlines||r.preserve_newlines,tt.break_chained_methods=void 0!==r.break_chained_methods&&r.break_chained_methods,tt.max_preserve_newlines=void 0===r.max_preserve_newlines?0:parseInt(r.max_preserve_newlines,10),tt.space_in_paren=void 0!==r.space_in_paren&&r.space_in_paren,tt.space_in_empty_paren=void 0!==r.space_in_empty_paren&&r.space_in_empty_paren,tt.jslint_happy=void 0!==r.jslint_happy&&r.jslint_happy,tt.space_after_anon_function=void 0!==r.space_after_anon_function&&r.space_after_anon_function,tt.keep_array_indentation=void 0!==r.keep_array_indentation&&r.keep_array_indentation,tt.space_before_conditional=void 0===r.space_before_conditional||r.space_before_conditional,tt.unescape_strings=void 0!==r.unescape_strings&&r.unescape_strings,tt.wrap_line_length=void 0===r.wrap_line_length?0:parseInt(r.wrap_line_length,10),tt.e4x=void 0!==r.e4x&&r.e4x,tt.end_with_newline=void 0!==r.end_with_newline&&r.end_with_newline,tt.jslint_happy&&(tt.space_after_anon_function=!0),r.indent_with_tabs&&(tt.indent_char="\t",tt.indent_size=1),G="";tt.indent_size>0;)G+=tt.indent_char,tt.indent_size-=1;var rt=0;if(n&&n.length){for(;" "===n.charAt(rt)||"\t"===n.charAt(rt);)nt+=n.charAt(rt),rt+=1;n=n.substring(rt)}X="TK_START_BLOCK",$="",q=new s(G,nt),J=[],v(u.BlockStatement),this.beautify=function(){var t,e;for(B=new a(n,tt,G),et=B.tokenize(),z=0;t=w();){for(var r=0;r<t.comments_before.length;r++)o(t.comments_before[r]);o(t),$=H.last_text,X=t.type,H.last_text=t.text,z+=1}return e=q.get_code(),tt.end_with_newline&&(e+="\n"),e}}function i(t){var e=0,n=-1,r=[],i=!0;this.set_indent=function(r){e=t.baseIndentLength+r*t.indent_length,n=r},this.get_character_count=function(){return e},this.is_empty=function(){return i},this.last=function(){return this._empty?null:r[r.length-1]},this.push=function(t){r.push(t),e+=t.length,i=!1},this.remove_indent=function(){n>0&&(n-=1,e-=t.indent_length)},this.trim=function(){for(;" "===this.last();){r.pop();e-=1}i=0===r.length},this.toString=function(){var e="";return this._empty||(n>=0&&(e=t.indent_cache[n]),e+=r.join("")),e}}function s(t,e){e=e||"",this.indent_cache=[e],this.baseIndentLength=e.length,this.indent_length=t.length;var n=[];this.baseIndentString=e,this.indent_string=t,this.current_line=null,this.space_before_token=!1,this.get_line_number=function(){return n.length},this.add_new_line=function(t){return(1!==this.get_line_number()||!this.just_added_newline())&&(!(!t&&this.just_added_newline())&&(this.current_line=new i(this),n.push(this.current_line),!0))},this.add_new_line(!0),this.get_code=function(){var t=n.join("\n").replace(/[\r\n\t ]+$/,"");return t},this.set_indent=function(t){if(n.length>1){for(;t>=this.indent_cache.length;)this.indent_cache.push(this.indent_cache[this.indent_cache.length-1]+this.indent_string);return this.current_line.set_indent(t),!0}return this.current_line.set_indent(0),!1},this.add_token=function(t){this.add_space_before_token(),this.current_line.push(t)},this.add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&this.current_line.push(" "),this.space_before_token=!1},this.remove_redundant_indentation=function(t){if(!t.multiline_frame&&t.mode!==u.ForInitializer&&t.mode!==u.Conditional)for(var e=t.start_line_index,r=n.length;e<r;)n[e].remove_indent(),e++},this.trim=function(r){for(r=void 0!==r&&r,this.current_line.trim(t,e);r&&n.length>1&&this.current_line.is_empty();)n.pop(),this.current_line=n[n.length-1],this.current_line.trim()},this.just_added_newline=function(){return this.current_line.is_empty()},this.just_added_blankline=function(){if(this.just_added_newline()){if(1===n.length)return!0;var t=n[n.length-2];return t.is_empty()}return!1}}function a(n,r,i){function s(){var s,m=[];if(h=0,p="",v>=y)return["","TK_EOF"];var b;b=d.length?d[d.length-1]:new l("TK_START_BLOCK","{");var x=n.charAt(v);for(v+=1;t(x,u);){if("\n"===x?(h+=1,m=[]):h&&(x===i?m.push(i):"\r"!==x&&m.push(" ")),v>=y)return["","TK_EOF"];x=n.charAt(v),v+=1}if(m.length&&(p=m.join("")),c.test(x)){var E=!0,T=!0,k=c;for("0"===x&&v<y&&/[Xx]/.test(n.charAt(v))?(E=!1,T=!1,x+=n.charAt(v),v+=1,k=/[0123456789abcdefABCDEF]/):(x="",v-=1);v<y&&k.test(n.charAt(v));)x+=n.charAt(v),v+=1,E&&v<y&&"."===n.charAt(v)&&(x+=n.charAt(v),v+=1,E=!1),T&&v<y&&/[Ee]/.test(n.charAt(v))&&(x+=n.charAt(v),v+=1,v<y&&/[+-]/.test(n.charAt(v))&&(x+=n.charAt(v),v+=1),T=!1,E=!1);return[x,"TK_WORD"]}if(o.isIdentifierStart(n.charCodeAt(v-1))){if(v<y)for(;o.isIdentifierChar(n.charCodeAt(v))&&(x+=n.charAt(v),v+=1,v!==y););return"TK_DOT"===b.type||"TK_RESERVED"===b.type&&t(b.text,["set","get"])||!t(x,g)?[x,"TK_WORD"]:"in"===x?[x,"TK_OPERATOR"]:[x,"TK_RESERVED"]}if("("===x||"["===x)return[x,"TK_START_EXPR"];if(")"===x||"]"===x)return[x,"TK_END_EXPR"];if("{"===x)return[x,"TK_START_BLOCK"];if("}"===x)return[x,"TK_END_BLOCK"];if(";"===x)return[x,"TK_SEMICOLON"];if("/"===x){var w="",S=!0;if("*"===n.charAt(v)){if(v+=1,v<y)for(;v<y&&("*"!==n.charAt(v)||!n.charAt(v+1)||"/"!==n.charAt(v+1))&&(x=n.charAt(v),w+=x,"\n"!==x&&"\r"!==x||(S=!1),v+=1,!(v>=y)););return v+=2,S&&0===h?["/*"+w+"*/","TK_INLINE_COMMENT"]:["/*"+w+"*/","TK_BLOCK_COMMENT"]}if("/"===n.charAt(v)){for(w=x;"\r"!==n.charAt(v)&&"\n"!==n.charAt(v)&&(w+=n.charAt(v),v+=1,!(v>=y)););return[w,"TK_COMMENT"]}}if("`"===x||"'"===x||'"'===x||("/"===x||r.e4x&&"<"===x&&n.slice(v-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&("TK_RESERVED"===b.type&&t(b.text,["return","case","throw","else","do","typeof","yield"])||"TK_END_EXPR"===b.type&&")"===b.text&&b.parent&&"TK_RESERVED"===b.parent.type&&t(b.parent.text,["if","while","for"])||t(b.type,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var R=x,A=!1,O=!1;if(s=x,"/"===R)for(var K=!1;v<y&&(A||K||n.charAt(v)!==R)&&!o.newline.test(n.charAt(v));)s+=n.charAt(v),A?A=!1:(A="\\"===n.charAt(v),"["===n.charAt(v)?K=!0:"]"===n.charAt(v)&&(K=!1)),v+=1;else if(r.e4x&&"<"===R){var C=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,N=n.slice(v-1),j=C.exec(N);if(j&&0===j.index){for(var D=j[2],L=0;j;){var P=!!j[1],I=j[2],F=!!j[j.length-1]||"![CDATA["===I.slice(0,8);if(I!==D||F||(P?--L:++L),L<=0)break;j=C.exec(N)}var V=j?j.index+j[0].length:N.length;return v+=V-1,[N.slice(0,V),"TK_STRING"]}}else for(;v<y&&(A||n.charAt(v)!==R&&("`"===R||!o.newline.test(n.charAt(v))));)s+=n.charAt(v),A?("x"!==n.charAt(v)&&"u"!==n.charAt(v)||(O=!0),A=!1):A="\\"===n.charAt(v),v+=1;if(O&&r.unescape_strings&&(s=a(s)),v<y&&n.charAt(v)===R&&(s+=R,v+=1,"/"===R))for(;v<y&&o.isIdentifierStart(n.charCodeAt(v));)s+=n.charAt(v),v+=1;return[s,"TK_STRING"]}if("#"===x){if(0===d.length&&"!"===n.charAt(v)){for(s=x;v<y&&"\n"!==x;)x=n.charAt(v),s+=x,v+=1;return[e(s)+"\n","TK_UNKNOWN"]}var M="#";if(v<y&&c.test(n.charAt(v))){do x=n.charAt(v),M+=x,v+=1;while(v<y&&"#"!==x&&"="!==x);return"#"===x||("["===n.charAt(v)&&"]"===n.charAt(v+1)?(M+="[]",v+=2):"{"===n.charAt(v)&&"}"===n.charAt(v+1)&&(M+="{}",v+=2)),[M,"TK_WORD"]}}if("<"===x&&"<!--"===n.substring(v-1,v+3)){for(v+=3,x="<!--";"\n"!==n.charAt(v)&&v<y;)x+=n.charAt(v),v++;return _=!0,[x,"TK_COMMENT"]}if("-"===x&&_&&"-->"===n.substring(v-1,v+2))return _=!1,v+=2,["-->","TK_COMMENT"];if("."===x)return[x,"TK_DOT"];if(t(x,f)){for(;v<y&&t(x+n.charAt(v),f)&&(x+=n.charAt(v),v+=1,!(v>=y)););return","===x?[x,"TK_COMMA"]:"="===x?[x,"TK_EQUALS"]:[x,"TK_OPERATOR"]}return[x,"TK_UNKNOWN"]}function a(t){for(var e,n=!1,r="",i=0,s="",a=0;n||i<t.length;)if(e=t.charAt(i),i++,n){if(n=!1,"x"===e)s=t.substr(i,2),i+=2;else{if("u"!==e){r+="\\"+e;continue}s=t.substr(i,4),i+=4}if(!s.match(/^[0123456789abcdefABCDEF]+$/))return t;if(a=parseInt(s,16),a>=0&&a<32){r+="x"===e?"\\x"+s:"\\u"+s;continue}if(34===a||39===a||92===a)r+="\\"+String.fromCharCode(a);else{if("x"===e&&a>126&&a<=255)return t;r+=String.fromCharCode(a)}}else"\\"===e?n=!0:r+=e;return r}var u="\n\r\t ".split(""),c=/[0-9]/,f="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: => <%= <% %> <?= <? ?>".split(" ");this.line_starters="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,yield,import,export".split(",");var h,p,_,d,v,y,g=this.line_starters.concat(["do","in","else","get","set","new","catch","finally","typeof"]);this.tokenize=function(){y=n.length,v=0,_=!1,d=[];for(var t,e,r,i=null,a=[],o=[];!e||"TK_EOF"!==e.type;){for(r=s(),t=new l(r[1],r[0],h,p);"TK_INLINE_COMMENT"===t.type||"TK_COMMENT"===t.type||"TK_BLOCK_COMMENT"===t.type||"TK_UNKNOWN"===t.type;)o.push(t),r=s(),t=new l(r[1],r[0],h,p);o.length&&(t.comments_before=o,o=[]),"TK_START_BLOCK"===t.type||"TK_START_EXPR"===t.type?(t.parent=e,i=t,a.push(t)):("TK_END_BLOCK"===t.type||"TK_END_EXPR"===t.type)&&i&&("]"===t.text&&"["===i.text||")"===t.text&&"("===i.text||"}"===t.text&&"}"===i.text)&&(t.parent=i.parent,i=a.pop()),d.push(t),e=t}return d}}var o={};!function(t){var e="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",n="------------------------------------------------------------------------------------------------------------------------------------------",r=new RegExp("["+e+"]"),i=new RegExp("["+e+n+"]");t.newline=/[\n\r\u2028\u2029]/,t.isIdentifierStart=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&r.test(String.fromCharCode(t)))},t.isIdentifierChar=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&i.test(String.fromCharCode(t))))}}(o);var u={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},l=function(t,e,n,r,i,s){this.type=t,this.text=e,this.comments_before=[],this.newlines=n||0,this.wanted_newline=n>0,this.whitespace_before=r||"",this.parent=null};return{js_beautify:n}}),define("skylark-utils-js/beautify",["./js","./primitives/beautify-js"],function(t,e){return t.beautify=e.js_beautify}),define("skylark-utils-html/primitives/beautify-html",["skylark-utils-css/beautify","skylark-utils-js/beautify"],function(t,e){function n(t){return t.replace(/^\s+/g,"")}function r(t){return t.replace(/\s+$/g,"")}function i(t,e,i,s){function a(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=u,this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,e){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}},this.is_whitespace=function(t){for(var e=0;e<t.length;t++)if(!this.Utils.in_array(t.charAt(e),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var t="";if(t=this.input.charAt(this.pos),this.Utils.in_array(t,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(t,this.Utils.whitespace);)_&&"\n"===t&&this.newlines<=d&&(this.newlines+=1),this.pos++,t=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(t){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,t),this.print_indentation(t)):(this.line_char_count++,t.push(" "))},this.get_content=function(){for(var t="",e=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(e);else{if(v){var n=this.input.substr(this.pos,3);if("{{#"===n||"{{/"===n)break;if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,e.push(t)}}return e.length?e.join(""):""},this.get_contents_to=function(t){if(this.pos===this.input.length)return["","TK_EOF"];var e="",n=new RegExp("</"+t+"\\s*>","igm");n.lastIndex=this.pos;var r=n.exec(this.input),i=r?r.index:this.input.length;return this.pos<i&&(e=this.input.substring(this.pos,i),this.pos=i),e},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1===this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.indent_to_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]])}},this.get_tag=function(t){var e,n,r,i="",s=[],a="",o=!1,u=this.pos,l=this.line_char_count;t=void 0!==t&&t;do{if(this.pos>=this.input.length)return t&&(this.pos=u,this.line_char_count=l),s.length?s.join(""):["","TK_EOF"];if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace))o=!0;else{if("'"!==i&&'"'!==i||(i+=this.get_unformatted(i),o=!0),"="===i&&(o=!1),s.length&&"="!==s[s.length-1]&&">"!==i&&o&&(this.space_or_wrap(s),o=!1),v&&"<"===r&&i+this.input.charAt(this.pos)==="{{"&&(i+=this.get_unformatted("}}"),s.length&&" "!==s[s.length-1]&&"<"!==s[s.length-1]&&(i=" "+i),o=!0),"<"!==i||r||(e=this.pos-1,r="<"),v&&!r&&s.length>=2&&"{"===s[s.length-1]&&"{"==s[s.length-2]&&(e="#"===i||"/"===i?this.pos-3:this.pos-2,r="{"),this.line_char_count++,s.push(i),s[1]&&"!"===s[1]){s=[this.get_comment(e)];break}if(v&&"{"===r&&s.length>2&&"}"===s[s.length-2]&&"}"===s[s.length-1])break}}while(">"!==i);var c,f,h=s.join("");c=h.indexOf(" ")!==-1?h.indexOf(" "):"{"===h[0]?h.indexOf("}"):h.indexOf(">"),f="<"!==h[0]&&v?"#"===h[2]?3:2:1;var _=h.substring(f,c).toLowerCase();return"/"===h.charAt(h.length-2)||this.Utils.in_array(_,this.Utils.single_token)?t||(this.tag_type="SINGLE"):v&&"{"===h[0]&&"else"===_?t||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(_,p)?(a=this.get_unformatted("</"+_+">",h),s.push(a),n=this.pos-1,this.tag_type="SINGLE"):"script"===_&&(h.search("type")===-1||h.search("type")>-1&&h.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?t||(this.record_tag(_),this.tag_type="SCRIPT"):"style"===_&&(h.search("type")===-1||h.search("type")>-1&&h.search("text/css")>-1)?t||(this.record_tag(_),this.tag_type="STYLE"):"!"===_.charAt(0)?t||(this.tag_type="SINGLE",this.traverse_whitespace()):t||("/"===_.charAt(0)?(this.retrieve_tag(_.substring(1)),this.tag_type="END"):(this.record_tag(_),"html"!==_.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(s),this.Utils.in_array(_,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),t&&(this.pos=u,this.line_char_count=l),s.join("")},this.get_comment=function(t){var e="",n=">",r=!1;for(this.pos=t,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&(e+=input_char,e[e.length-1]!==n[n.length-1]||e.indexOf(n)===-1);)!r&&e.length<10&&(0===e.indexOf("<![if")?(n="<![endif]>",r=!0):0===e.indexOf("<![cdata[")?(n="]]>",r=!0):0===e.indexOf("<![")?(n="]>",r=!0):0===e.indexOf("<!--")&&(n="-->",r=!0)),input_char=this.input.charAt(this.pos),this.pos++;return e},this.get_unformatted=function(t,e){if(e&&e.toLowerCase().indexOf(t)!==-1)return"";var n="",r="",i=0,s=!0;do{if(this.pos>=this.input.length)return r;if(n=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(n,this.Utils.whitespace)){if(!s){this.line_char_count--;continue}if("\n"===n||"\r"===n){r+="\n",this.line_char_count=0;continue}}r+=n,this.line_char_count++,s=!0,v&&"{"===n&&r.length&&"{"===r[r.length-2]&&(r+=this.get_unformatted("}}"),i=r.length)}while(r.toLowerCase().indexOf(t,i)===-1);return r},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var e=this.last_token.substr(7);return t=this.get_contents_to(e),"string"!=typeof t?t:[t,"TK_"+e]}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var n="TK_TAG_"+this.tag_type;return[t,n]}},this.get_full_indent=function(t){return t=this.indent_level+t||0,t<1?"":Array(t+1).join(this.indent_string)},this.is_unformatted=function(t,e){if(!this.Utils.in_array(t,e))return!1;if("a"!==t.toLowerCase()||!this.Utils.in_array("a",e))return!0;var n=this.get_tag(!0),r=(n||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!(r&&!this.Utils.in_array(r,e))},this.printer=function(t,e,i,s,a){this.input=t||"",this.output=[],this.indent_character=e,this.indent_string="",this.indent_size=i,this.brace_style=a,this.indent_level=0,this.wrap_line_length=s,this.line_char_count=0;for(var o=0;o<this.indent_size;o++)this.indent_string+=this.indent_character;this.print_newline=function(t,e){this.line_char_count=0,e&&e.length&&(t||"\n"!==e[e.length-1])&&("\n"!==e[e.length-1]&&(e[e.length-1]=r(e[e.length-1])),e.push("\n"))},this.print_indentation=function(t){for(var e=0;e<this.indent_level;e++)t.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(t){this.is_whitespace(t)&&!this.output.length||((t||""!==t)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),t=n(t)),this.print_token_raw(t))},this.print_token_raw=function(t){this.newlines>0&&(t=r(t)),t&&""!==t&&(t.length>1&&"\n"===t[t.length-1]?(this.output.push(t.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(t));for(var e=0;e<this.newlines;e++)this.print_newline(e>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var o,u,l,c,f,h,p,_,d,v,y;for(e=e||{},void 0!==e.wrap_line_length&&0!==parseInt(e.wrap_line_length,10)||void 0===e.max_char||0===parseInt(e.max_char,10)||(e.wrap_line_length=e.max_char),u=void 0!==e.indent_inner_html&&e.indent_inner_html,l=void 0===e.indent_size?4:parseInt(e.indent_size,10),c=void 0===e.indent_char?" ":e.indent_char,h=void 0===e.brace_style?"collapse":e.brace_style,f=0===parseInt(e.wrap_line_length,10)?32786:parseInt(e.wrap_line_length||250,10),p=e.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],_=void 0===e.preserve_newlines||e.preserve_newlines,d=_?isNaN(parseInt(e.max_preserve_newlines,10))?32786:parseInt(e.max_preserve_newlines,10):0,v=void 0!==e.indent_handlebars&&e.indent_handlebars,y=void 0!==e.end_with_newline&&e.end_with_newline,o=new a,o.printer(t,c,l,f,h);;){var g=o.get_token();if(o.token_text=g[0],o.token_type=g[1],"TK_EOF"===o.token_type)break;switch(o.token_type){case"TK_TAG_START":o.print_newline(!1,o.output),o.print_token(o.token_text),o.indent_content&&(o.indent(),o.indent_content=!1),o.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===o.last_token&&""===o.last_text){var m=o.token_text.match(/\w+/)[0],b=null;o.output.length&&(b=o.output[o.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),null!==b&&b[1]===m||o.print_newline(!1,o.output)}o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var x=o.token_text.match(/^\s*<([a-z-]+)/i);x&&o.Utils.in_array(x[1],p)||o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":o.print_token(o.token_text),o.indent_content&&(o.indent(),o.indent_content=!1),o.current_mode="CONTENT";break;case"TK_CONTENT":o.print_token(o.token_text),o.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==o.token_text){o.print_newline(!1,o.output);var E,T=o.token_text,k=1;"TK_SCRIPT"===o.token_type?E="function"==typeof i&&i:"TK_STYLE"===o.token_type&&(E="function"==typeof s&&s),"keep"===e.indent_scripts?k=0:"separate"===e.indent_scripts&&(k=-o.indent_level);var w=o.get_full_indent(k);if(E)T=E(T.replace(/^\s*/,w),e);else{var S=T.match(/^\s*/)[0],R=S.match(/[^\n\r]*$/)[0].split(o.indent_string).length-1,A=o.get_full_indent(k-R);T=T.replace(/^\s*/,w).replace(/\r\n|\r|\n/g,"\n"+A).replace(/\s+$/,"")}T&&(o.print_token_raw(T),o.print_newline(!0,o.output))}o.current_mode="TAG";break;default:""!==o.token_text&&o.print_token(o.token_text)}o.last_token=o.token_type,o.last_text=o.token_text}var O=o.output.join("").replace(/[\r\n\t ]+$/,"");return y&&(O+="\n"),O}return{html_beautify:function(e,n){return i(e,n,beautifyJs,t)}}}),define("skylark-utils-html/beautify",["./html","./primitives/beautify-html"],function(t,e){return t.beautify=e.html_beautify}),define("skylark-utils-html/main",["./html","./beautify"],function(t){return t}),define("skylark-utils-html",["skylark-utils-html/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-html-all.js.map
