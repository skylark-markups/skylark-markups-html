/**
 * skylark-utils-html - The html features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){function n(e,t){if("."!==e[0])return e;var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}var r=t.define,i=t.require,s="function"==typeof r&&r.amd,a=!s&&"undefined"!=typeof exports;if(!s&&!r){var o={};r=t.define=function(e,t,r){"function"==typeof r?(o[e]={factory:r,deps:t.map(function(t){return n(t,e)}),exports:null},i(e)):o[e]=r},i=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=o[e];if(!t.exports){var n=[];t.deps.forEach(function(e){n.push(i(e))}),t.exports=t.factory.apply(window,n)}return t.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(e(r,i),!s){var u=i("skylark-utils-interact/main");a?exports=u:t.skylarkjs=u}}(function(define,require){define("skylark-langx/skylark",[],function(){var e={};return e}),define("skylark-utils/skylark",["skylark-langx/skylark"],function(e){return e}),define("skylark-utils-html/html",["skylark-utils/skylark"],function(e){return e.html=e.html||{}}),define("skylark-langx/langx",["./skylark"],function(skylark){"use strict";function createAssigner(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var s=arguments[i],a=e(s),o=a.length,u=0;u<o;u++){var l=a[u];t&&void 0!==n[l]||(n[l]=s[l])}return n}}function advise(e,t,n,r){var i,s=e[t],a="around"==t;if(a){var o=n(function(){return s.advice(this,arguments)});i={remove:function(){o&&(o=e=n=null)},advice:function(e,t){return o?o.apply(e,t):s.advice(e,t)}}}else i={remove:function(){if(i.advice){var r=i.previous,s=i.next;s||r?(r?r.next=s:e[t]=s,s&&(s.previous=r)):delete e[t],e=n=i.advice=null}},id:nextId++,advice:n,receiveArguments:r};if(s&&!a)if("after"==t){for(;s.next&&(s=s.next););s.next=i,i.previous=s}else"before"==t&&(e[t]=i,i.next=s,s.previous=i);else e[t]=i;return i}function aspect(e){return function(t,n,r,i){var s,a=t[n];a&&a.target==t||(t[n]=s=function(){for(var e=nextId,t=arguments,n=s.before;n;)t=n.advice.apply(this,t)||t,n=n.next;if(s.around)var r=s.around.advice(this,t);for(var i=s.after;i&&i.id<e;){if(i.receiveArguments){var a=i.advice.apply(this,t);r=a===undefined?r:a}else r=i.advice.call(this,r,t);i=i.next}return r},a&&(s.around={advice:function(e,t){return a.apply(e,t)}}),s.target=t);var o=advise(s||a,e,r,i);return r=null,o}}function allKeys(e){if(!isObject(e))return[];var t=[];for(var n in e)t.push(n);return t}function createEvent(e,t){var n=new CustomEvent(e,t);return safeMixin(n,t)}function debounce(e,t){var n,r,i=function(){e.apply(null,r)};return function(){r=arguments,clearTimeout(n),n=setTimeout(i,t)}}function values(e){for(var t=_.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function clone(e,t){var n;if(e===undefined||null===e)n=e;else if(t&&e.clone)n=e.clone();else if(isArray(e)){n=[];for(var r=0;r<e.length;r++)n.push(clone(e[r]))}else if(isPlainObject(e)){n={};for(var i in e)n[i]=clone(e[i])}else n=e;return n}function compact(e){return filter.call(e,function(e){return null!=e})}function dasherize(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function deserializeValue(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?JSON.parse(e):e):e}catch(t){return e}}function each(e,t){var n,r,i,s,a;if(e)if(n=e.length,n===s){for(r in e)if(e.hasOwnProperty(r)&&(a=e[r],t.call(a,r,a)===!1))break}else for(i=0;i<n&&(a=e[i],t.call(a,i,a)!==!1);i++);return this}function flatten(e){if(isArrayLike(e)){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(isArrayLike(r))for(var i=0;i<r.length;i++)t.push(r[i]);else t.push(r)}return t}return e}function funcArg(e,t,n,r){return isFunction(t)?t.call(e,n,r):t}function getQueryParams(e){var e=e||window.location.href,t=e.split("?"),n={};return t.length>1&&t[1].split("&").forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n}function grep(e,t){var n=[];return each(e,function(e,r){t(r,e)&&n.push(r)}),n}function has(e,t){if(!isArray(t))return null!=e&&hasOwnProperty.call(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!hasOwnProperty.call(e,i))return!1;e=e[i]}return!!n}function inArray(e,t){if(!t)return-1;var n;if(t.indexOf)return t.indexOf(e);for(n=t.length;n--;)if(t[n]===e)return n;return-1}function inherit(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n}function isArray(e){return e&&e.constructor===Array}function isArrayLike(e){return!isString(e)&&!isHtmlNode(e)&&"number"==typeof e.length&&!isFunction(e)}function isBoolean(e){return"boolean"==typeof e}function isDocument(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function isEqual(e,t){return eq(e,t)}function isFunction(e){return"function"==type(e)}function isObject(e){return"object"==type(e)}function isPlainObject(e){return isObject(e)&&!isWindow(e)&&Object.getPrototypeOf(e)==Object.prototype}function isString(e){return"string"==typeof e}function isWindow(e){return e&&e==e.window}function isDefined(e){return"undefined"!=typeof e}function isHtmlNode(e){return e&&e instanceof Node}function isInstanceOf(e,t){return e!==undefined&&(null===e||t==Object||("number"==typeof e?t===Number:"string"==typeof e?t===String:"boolean"==typeof e?t===Boolean:"string"==typeof e?t===String:e instanceof t||!(!e||!e.isInstanceOf)&&e.isInstanceOf(t)))}function isNumber(e){return"number"==typeof e}function isSameOrigin(e){if(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e.startsWith(t)}}function isEmptyObject(e){var t;for(t in e)if(null!==e[t])return!1;return!0}function isMatch(e,t){var n=n(t),r=n.length;if(null==e)return!r;for(var i=Object(e),s=0;s<r;s++){var a=n[s];if(t[a]!==i[a]||!(a in i))return!1}return!0}function keys(e){if(isObject(e))return[];var t=[];for(var n in e)has(e,n)&&t.push(n);return t}function makeArray(e,t,n){return isArrayLike(e)?(n||[]).concat(Array.prototype.slice.call(e,t||0)):[e]}function map(e,t){var n,r,i,s=[];if(isArrayLike(e))for(r=0;r<e.length;r++)n=t.call(e[r],e[r],r),null!=n&&s.push(n);else for(i in e)n=t.call(e[i],e[i],i),null!=n&&s.push(n);return flatten(s)}function defer(e){return requestAnimationFrame?requestAnimationFrame(e):setTimeoutout(e),this}function noop(){}function proxy(e,t){var n=2 in arguments&&slice.call(arguments,2);if(isFunction(e)){var r=function(){return e.apply(t,n?n.concat(slice.call(arguments)):arguments)};return r}if(isString(t))return n?(n.unshift(e[t],e),proxy.apply(null,n)):proxy(e[t],e);throw new TypeError("expected function")}function toPixel(e){return parseFloat(e)||0}function trim(e){return null==e?"":String.prototype.trim.call(e)}function removeItem(e,t){if(isArray(e)){var n=e.indexOf(t);n!=-1&&e.splice(n,1)}else if(isPlainObject(e))for(var r in e)if(e[r]==t){delete e[r];break}return this}function _mixin(e,t,n,r){for(var i in t)r&&e[i]!==undefined||(n&&(isPlainObject(t[i])||isArray(t[i]))?(isPlainObject(t[i])&&!isPlainObject(e[i])&&(e[i]={}),isArray(t[i])&&!isArray(e[i])&&(e[i]=[]),_mixin(e[i],t[i],n,r)):t[i]!==undefined&&(e[i]=t[i]));return e}function _parseMixinArgs(e){var t=slice.call(arguments,0),n=t.shift(),r=!1;return isBoolean(t[t.length-1])&&(r=t.pop()),{target:n,sources:t,deep:r}}function mixin(){var e=_parseMixinArgs.apply(this,arguments);return e.sources.forEach(function(t){_mixin(e.target,t,e.deep,!1)}),e.target}function result(e,t,n){isArray(t)||(t=[t]);var r=t.length;if(!r)return isFunction(n)?n.call(e):n;for(var i=0;i<r;i++){var s=null==e?void 0:e[t[i]];void 0===s&&(s=n,i=r),e=isFunction(s)?s.call(e):s}return e}function safeMixin(){var e=_parseMixinArgs.apply(this,arguments);return e.sources.forEach(function(t){_mixin(e.target,t,e.deep,!0)}),e.target}function substitute(e,t,n,r){function i(e,t){if(e.match(/\./)){var n,r=function(e,t){var i=e.pop();return i?t[i]?r(e,n=t[i]):null:n};return r(e.split(".").reverse(),t)}return t[e]}return r=r||window,n=n?proxy(r,n):function(e){return e},e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(e,s,a){var o=i(s,t);return a&&(o=i(a,r).call(r,o,s)),n(o,s).toString()})}function uid(e){return e._uid||(e._uid=_uid++)}function uniq(e){return filter.call(e,function(t,n){return e.indexOf(t)==n})}function uniqueId(e){var t=++idCounter+"";return e?e+t:t}function langx(){return langx}var toString={}.toString,concat=Array.prototype.concat,indexOf=Array.prototype.indexOf,slice=Array.prototype.slice,filter=Array.prototype.filter,hasOwnProperty=Object.prototype.hasOwnProperty,PGLISTENERS=Symbol?Symbol():"__pglisteners",eq,deepEq,SymbolProto="undefined"!=typeof Symbol?Symbol.prototype:null;eq=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return!1;if(e!==e)return t!==t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&deepEq(e,t,n,r)},deepEq=function(e,t,n,r){var i=toString.call(e);if(i!==toString.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return SymbolProto.valueOf.call(e)===SymbolProto.valueOf.call(t)}var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,o=t.constructor;if(a!==o&&!(isFunction(a)&&a instanceof a&&isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),s){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!eq(e[u],t[u],n,r))return!1}else{var l,c=Object.keys(e);if(u=c.length,Object.keys(t).length!==u)return!1;for(;u--;)if(l=c[u],t[l]===undefined||!eq(e[l],t[l],n,r))return!1}return n.pop(),r.pop(),!0};var undefined,nextId=0,f1=function(){function e(e,t,n){var r=e.prototype,i=e.superclass.prototype,s=n&&n.noOverrided;for(var a in t)if("constructor"!==a){var o=t[a];"function"==typeof t[a]?r[a]=o._constructor||s||"function"!=typeof i[a]?o:function(e,t,n){return function(){var e=this.overrided;this.overrided=n;var r=t.apply(this,arguments);return this.overrided=e,r}}(a,o,i[a]):"object"==typeof o&&null!==o&&o.get?Object.defineProperty(r,a,o):r[a]=o}return e}function t(e,t){var n=[];return t.forEach(function(e){if(has(e,"__mixins__"))throw new Error("nested mixins");for(var t=[];e;)t.unshift(e),e=e.superclass;n=n.concat(t)}),n=uniq(n),n=n.filter(function(t){for(var n=e;n;){if(t===n)return!1;if(has(n,"__mixins__"))for(var r=n.__mixins__,i=0;i<r.length;i++)if(r[i]===t)return!1;n=n.superclass}return!0}),n.length>0&&n}function n(e,t){for(var n=e,r=0;r<t.length;r++){var i=new Function;i.prototype=Object.create(n.prototype),i.__proto__=n,i.superclass=null,mixin(i.prototype,t[r].prototype),i.prototype.__mixin__=t[r],n=i}return n}return function r(i,s,a,o){isArray(s)&&(o=a,a=s,s=null),s=s||Object,isDefined(a)&&!isArray(a)&&(o=a,a=!1);var u=s;a&&(a=t(u,a)),a&&(u=n(u,a));var l=i.constructor;l===Object&&(l=function(){if(this.init)return this.init.apply(this,arguments)});var c=i.klassName||"",f=new Function("return function "+c+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return f._constructor=l,f.prototype=Object.create(u.prototype),f.prototype.constructor=f,f.superclass=s,f.__proto__=u,a&&(f.__mixins__=a),f.partial||(f.partial=function(t,n){return e(this,t,n)}),f.inherit||(f.inherit=function(e,t,n){return r(e,this,t,n)}),f.partial(i,o),f}},createClass=f1(),delegate=function(){function e(){}return function(t,n){e.prototype=t;var r=new e;return e.prototype=null,n&&mixin(r,n),r}}(),getAbsoluteUrl=function(){var e;return function(t){return e||(e=document.createElement("a")),e.href=t,e.href}}(),type=function(){var e={};return each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,n){e["[object "+n+"]"]=n.toLowerCase()}),function(t){return null==t?String(t):e[toString.call(t)]||"object"}}(),_uid=1,idCounter=0,Deferred=function(){var e=this,t=this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n}),n={state:function(){return e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},then:function(e,t,r){return r&&this.progress(r),mixin(Promise.prototype.then.call(this,e&&function(t){return t&&t.__ctx__!==undefined?e.apply(t.__ctx__,t):e(t)},t&&function(e){return e&&e.__ctx__!==undefined?t.apply(e.__ctx__,e):t(e)}),n)},always:function(e){return this.then(e,e),this},done:function(e){return this.then(e)},fail:function(e){return this.then(null,e)},progress:function(t){return e[PGLISTENERS].push(t),this}};n.pipe=n.then,mixin(t,n),this[PGLISTENERS]=[]};Deferred.prototype.resolve=function(e){var t=slice.call(arguments);return this.resolveWith(null,t)},Deferred.prototype.resolveWith=function(e,t){return t=t?makeArray(t):[],t.__ctx__=e,this._resolve(t),this._resolved=!0,this},Deferred.prototype.progress=function(e){try{return this[PGLISTENERS].forEach(function(t){return t(e)})}catch(t){this.reject(t)}return this},Deferred.prototype.reject=function(e){var t=slice.call(arguments);return this.rejectWith(null,t)},Deferred.prototype.rejectWith=function(e,t){return t=t?makeArray(t):[],t.__ctx__=e,this._reject(t),this._rejected=!0,this},Deferred.prototype.isResolved=function(){return!!this._resolved},Deferred.prototype.isRejected=function(){return!!this._rejected},Deferred.prototype.then=function(e,t,n){var r=result(this,"promise");return r.then(e,t,n)},Deferred.prototype.done=Deferred.prototype.then,Deferred.all=function(e){return Promise.all(e)},Deferred.first=function(e){return Promise.race(e)},Deferred.when=function(e,t,n,r){var i=e&&"function"==typeof e.then;i&&e instanceof Promise;return i?t||n||r?e.then(t,n,r):e:arguments.length>1?t?t(e):e:(new Deferred).resolve(e)},Deferred.reject=function(e){var t=new Deferred;return t.reject(e),t.promise},Deferred.resolve=function(e){var t=new Deferred;return t.resolve(e),t.promise},Deferred.immediate=Deferred.resolve;var Evented=createClass({on:function(e,t,n,r,i,s){var a=this,o=this._hub||(this._hub={});return isPlainObject(e)?(i=r,each(e,function(e,r){a.on(e,t,n,r,i,s)}),this):(isString(t)||isFunction(r)||(i=r,r=n,n=t,t=undefined),isFunction(n)&&(i=r,r=n,n=null),isString(e)&&(e=e.split(/\s/)),e.forEach(function(e){(o[e]||(o[e]=[])).push({fn:r,selector:t,data:n,ctx:i,one:s})}),this)},one:function(e,t,n,r,i){return this.on(e,t,n,r,i,1)},trigger:function(e){if(!this._hub)return this;var t=this;isString(e)&&(e=new CustomEvent(e)),Object.defineProperty(e,"target",{value:this});var n=slice.call(arguments,1);return n=isDefined(n)?[e].concat(n):[e],[e.type||e.name,"all"].forEach(function(r){var i=t._hub[r];if(i){for(var s=i.length,a=!1,o=0;o<s;o++){var u=i[o];e.data?u.data&&(e.data=mixin({},u.data,e.data)):e.data=u.data||null,u.fn.apply(u.ctx,n),u.one&&(i[o]=null,a=!0)}a&&(t._hub[r]=compact(i))}}),this},listened:function(e){var t=(this._hub||(this._events={}))[e]||[];return t.length>0},listenTo:function(e,t,n,r){if(!e)return this;isString(n)&&(n=this[n]),r?e.one(t,n,this):e.on(t,n,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),a=0;a<s.length;a++)if(s[a].obj==e){i=s[a];break}i||s.push(i={obj:e,events:{}});var o=i.events,u=o[t]=o[t]||[];return u.indexOf(n)==-1&&u.push(n),this},listenToOnce:function(e,t,n){return this.listenTo(e,t,n,1)},off:function(e,t){var n=this._hub||(this._hub={});return isString(e)&&(e=e.split(/\s/)),e.forEach(function(e){var r=n[e],i=[];if(r&&t)for(var s=0,a=r.length;s<a;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);i.length?n[e]=i:delete n[e]}),this},unlistenTo:function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var s=r[i];if(!e||e==s.obj){var a=s.events;for(var o in a)if(!t||t==o){for(var u=a[o],l=0;l<u.length;l++)n&&n!=u[i]||(s.obj.off(o,u[i],this),u[i]=null);u=a[o]=compact(u),isEmptyObject(u)&&(a[o]=null)}isEmptyObject(a)&&(r[i]=null)}}return r=this._listeningTo=compact(r),isEmptyObject(r)&&(this._listeningTo=null),this}}),Stateful=Evented.inherit({init:function(e,t){var n=e||{};t||(t={}),this.cid=uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var r=result(this,"defaults");n=mixin({},r,n),this.set(n,t),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(e){return clone(this.attributes)},get:function(e){return this.attributes[e]},has:function(e){return null!=this.get(e)},set:function(e,t,n){if(null==e)return this;var r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;var i=n.unset,s=n.silent,a=[],o=this._changing;this._changing=!0,o||(this._previousAttributes=clone(this.attributes),this.changed={});var u=this.attributes,l=this.changed,c=this._previousAttributes;for(var f in r)t=r[f],isEqual(u[f],t)||a.push(f),isEqual(c[f],t)?delete l[f]:l[f]=t,i?delete u[f]:u[f]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(var h=0;h<a.length;h++)this.trigger("change:"+a[h],this,u[a[h]],n)}if(o)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,mixin({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,mixin({},e,{unset:!0}))},hasChanged:function(e){return null==e?!isEmptyObject(this.changed):this.changed[e]!==undefined},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var r in e){var i=e[r];isEqual(t[r],i)||(n[r]=i)}return!isEmptyObject(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return clone(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},mixin({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=mixin({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,mixin(t,{validationError:n})),!1)}}),SimpleQueryEngine=function(e,t){function n(e,t,n){var r,i=0,s=e&&e.length||0,a=[];if(s&&"string"==typeof e&&(e=e.split("")),"string"==typeof t&&(t=cache[t]||buildFn(t)),n)for(;i<s;++i)r=e[i],t.call(n,r,i,e)&&a.push(r);else for(;i<s;++i)r=e[i],t(r,i,e)&&a.push(r);return a}function r(r){var i=n(r,e),s=t&&t.sort;if(s&&i.sort("function"==typeof s?s:function(e,t){for(var n,r=0;n=s[r];r++){var i=e[n.attribute],a=t[n.attribute];if(i=null!=i?i.valueOf():i,a=null!=a?a.valueOf():a,i!=a)return!!n.descending==(null==i||i>a)?-1:1}return 0}),t&&(t.start||t.count)){var a=i.length;i=i.slice(t.start||0,(t.start||0)+(t.count||1/0)),i.total=a}return i}switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var i=e;e=function(e){for(var t in i){var n=i[t];if(n&&n.test){if(!n.test(e[t],e))return!1}else if(n!=e[t])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}return r.matches=e,r},QueryResults=function(e){function t(t){e[t]=function(){var r=arguments,i=Deferred.when(e,function(e){return QueryResults(Array.prototype[t].apply(e,r))});if("forEach"!==t||n)return i}}if(!e)return e;var n=!!e.then;return n&&(e=Object.delegate(e)),t("forEach"),t("filter"),t("map"),null==e.total&&(e.total=Deferred.when(e,function(e){return e.length})),e},async={parallel:function(e,t,n){var r=[];return n=n||null,t=t||[],each(e,function(e,i){r.push(i.apply(n,t))}),Deferred.all(r)},series:function(e,t,n){var r=[],i=new Deferred,s=i.promise;return n=n||null,t=t||[],i.resolve(),each(e,function(e,i){s=s.then(function(){return i.apply(n,t)}),r.push(s)}),Deferred.all(r)},waterful:function(e,t,n){var r=new Deferred,i=r.promise;return n=n||null,t=t||[],r.resolveWith(n,t),each(e,function(e,t){i=i.then(t)}),i}},ArrayStore=createClass({klassName:"ArrayStore",queryEngine:SimpleQueryEngine,idProperty:"id",get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var n=this.data,r=this.index,i=this.idProperty,s=e[i]=t&&"id"in t?t.id:i in e?e[i]:Math.random();if(s in r){if(t&&t.overwrite===!1)throw new Error("Object already exists");n[r[s]]=e}else r[s]=n.push(e)-1;return s},add:function(e,t){return(t=t||{}).overwrite=!1,this.put(e,t)},remove:function(e){var t=this.index,n=this.data;if(e in t)return n.splice(t[e],1),this.setData(n),!0},query:function(e,t){return QueryResults(this.queryEngine(e,t)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e,this.index={};for(var t=0,n=e.length;t<n;t++)this.index[e[t][this.idProperty]]=t},init:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])}}),Xhr=function(){function mimeToDataType(e){if(e&&(e=e.split(";",2)[0]),e){if(e==htmlType)return"html";if(e==jsonType)return"json";if(scriptTypeRE.test(e))return"script";if(xmlTypeRE.test(e))return"xml"}return"text"}function appendQuery(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.data=e.data||e.query,e.processData&&e.data&&"string"!=type(e.data)&&(e.data=param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=appendQuery(e.url,e.data),e.data=undefined)}function serialize(e,t,n,r){var i,s=isArray(t),a=isPlainObject(t);each(t,function(t,o){i=type(o),r&&(t=n?r:r+"["+(a||"object"==i||"array"==i?t:"")+"]"),!r&&s?e.add(o.name,o.value):"array"==i||!n&&"object"==i?serialize(e,o,n,t):e.add(t,o)})}var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}},param=function(e,t){var n=[];return n.add=function(e,t){isFunction(t)&&(t=t()),null==t&&(t=""),this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(e){error=e}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(e){deferred&&deferred.progress(e,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&contentType!==!1&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var e=this._,t=e.xhr;t&&t.abort()},request:function(e){return this._request(e)},get:function(e){return e=e||{},e.type="GET",this._request(e)},post:function(e){return e=e||{},e.type="POST",this._request(e)},patch:function(e){return e=e||{},e.type="PATCH",this._request(e)},put:function(e){return e=e||{},e.type="PUT",this._request(e)},del:function(e){return e=e||{},e.type="DELETE",this._request(e)},init:function(e){this._={options:e||{}}}});return["request","get","post","put","del","patch"].forEach(function(e){Xhr[e]=function(t,n){var r=new Xhr({url:t});return r[e](n)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}(),Restful=Evented.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(e){var t=String.substitute(this.baseEndpoint,e),n=this.server+this.basePath+t;return e[this.idAttribute]!==undefined&&(n=n+"/"+e[this.idAttribute]),n},_head:function(e){},_get:function(e){return Xhr.get(this.getBaseUrl(e),e)},_post:function(e,t){var n=this.getBaseUrl(e);return t&&(n=n+"/"+t),Xhr.post(n,e)},_put:function(e,t){var n=this.getBaseUrl(e);return t&&(n=n+"/"+t),Xhr.put(n,e)},_delete:function(e){var t=this.getBaseUrl(e);return Xhr.del(t)},_patch:function(e){var t=this.getBaseUrl(e);return Xhr.patch(t,e)},query:function(e){return this._post(e)},retrieve:function(e){return this._get(e)},create:function(e){return this._post(e)},update:function(e){return this._put(e)},"delete":function(e){return this._delete(e)},patch:function(e){return this._patch(e)},init:function(e){mixin(this,e)}});return mixin(langx,{after:aspect("after"),allKeys:allKeys,around:aspect("around"),ArrayStore:ArrayStore,async:async,before:aspect("before"),camelCase:function(e){return e.replace(/-([\da-z])/g,function(e){return e.toUpperCase().replace("-","")})},clone:clone,compact:compact,createEvent:createEvent,dasherize:dasherize,debounce:debounce,defaults:createAssigner(allKeys,!0),delegate:delegate,Deferred:Deferred,Evented:Evented,defer:defer,deserializeValue:deserializeValue,each:each,first:function(e,t){return t?e.slice(0,t):e[0]},flatten:flatten,funcArg:funcArg,getQueryParams:getQueryParams,has:has,inArray:inArray,isArray:isArray,isArrayLike:isArrayLike,isBoolean:isBoolean,isDefined:function(e){return e!==undefined},isDocument:isDocument,isEmptyObject:isEmptyObject,isEqual:isEqual,isFunction:isFunction,isHtmlNode:isHtmlNode,isMatch:isMatch,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isString:isString,isSameOrigin:isSameOrigin,isWindow:isWindow,keys:keys,klass:function(e,t,n,r){return createClass(e,t,n,r)},lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},makeArray:makeArray,map:map,mixin:mixin,noop:noop,proxy:proxy,removeItem:removeItem,Restful:Restful,result:result,returnTrue:function(){return!0},returnFalse:function(){return!1},safeMixin:safeMixin,serializeValue:function(e){return JSON.stringify(e)},Stateful:Stateful,substitute:substitute,toPixel:toPixel,trim:trim,type:type,uid:uid,uniq:uniq,uniqueId:uniqueId,upperFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null,values:values,Xhr:Xhr}),skylark.langx=langx}),define("skylark-utils/langx",["skylark-langx/langx"],function(e){return e}),define("skylark-utils/browser",["./skylark","./langx"],function(e,t){function n(e){return c?c+e:e.toLowerCase()}function r(e){return h[e]||e}function i(e){return f[e]||e}function s(){return s}var a,o,u="",l="",c="",f={},h={},p=/^(Webkit|webkit|O|Moz|moz|ms)(.*)$/,d=window.document,_=d.createElement("div"),v=_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.matchesSelector,y=_.requestFullscreen||_.webkitRequestFullscreen||_.mozRequestFullScreen||_.msRequestFullscreen,m=(d.exitFullscreen||d.webkitCancelFullScreen||d.mozCancelFullScreen||d.msExitFullscreen,_.style);for(var g in m){var b=g.match(o||p);if(b){o||(a=b[1],o=new RegExp("^("+a+")(.*)$"),l=a,u="-"+a.toLowerCase()+"-",c=a.toLowerCase()),f[t.lowerFirst(b[2])]=g;var x=t.dasherize(b[2]);h[x]=u+x}}return t.mixin(s,{css3PropPrefix:u,normalizeStyleProperty:i,normalizeCssProperty:r,normalizeCssEvent:n,matchesSelector:v,requestFullScreen:y,exitFullscreen:y,location:function(){return window.location},support:{}}),_=null,e.browser=s}),define("skylark-utils/styler",["./skylark","./langx"],function(e,t){function n(e,t){return"number"!=typeof t||y[v(e)]?t:t+"px"}function r(e){return e in m?m[e]:m[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function i(e,t){var n=e.className||"",r=n&&void 0!==n.baseVal;return void 0===t?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function s(e){var t,n;return g[e]||(t=document.createElement(e),document.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),g[e]=n),g[e]}function a(e){return b.css(e,"display",""),"none"==b.css(e,"display")&&b.css(e,"display",s(e.nodeName)),this}function o(e){return"none"==b.css(e,"display")||0==b.css(e,"opacity")}function u(e){return b.css(e,"display","none"),this}function l(e,n){if(!n)return this;var s,a=i(e);return s=t.isString(n)?n.split(/\s+/g):n,s.forEach(function(e){var t=r(e);a.match(t)||(a+=(a?" ":"")+e)}),i(e,a),this}function c(e,r,i){if(arguments.length<3){var s,s=getComputedStyle(e,"");if(t.isString(r))return e.style[_(r)]||s.getPropertyValue(r);if(t.isArrayLike(r)){var a={};return d.call(r,function(t){a[t]=e.style[_(t)]||s.getPropertyValue(t)}),a}}var o="";if("string"==typeof r)i||0===i?o=v(r)+":"+n(r,i):e.style.removeProperty(v(r));else for(key in r)void 0!==r[key]&&(r[key]||0===r[key]?o+=v(key)+":"+n(key,r[key])+";":e.style.removeProperty(v(key)));return e.style.cssText+=";"+o,this}function f(e,t){var n=r(t);return e.className&&e.className.match(n)}function h(e,n){if(n){var s,a=i(e);s=t.isString(n)?n.split(/\s+/g):n,s.forEach(function(e){var t=r(e);a.match(t)&&(a=a.replace(t," "))}),i(e,a.trim())}else i(e,"");return this}function p(e,t,n){var r=this;return t.split(/\s+/g).forEach(function(t){void 0===n&&(n=!r.hasClass(e,t)),n?r.addClass(e,t):r.removeClass(e,t)}),r}var d=(Array.prototype.every,Array.prototype.forEach),_=t.camelCase,v=t.dasherize,y={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},m={},g={},b=function(){return b};return t.mixin(b,{autocssfix:!1,cssHooks:{},addClass:l,className:i,css:c,hasClass:f,hide:u,isInvisible:o,removeClass:h,show:a,toggleClass:p}),e.styler=b}),define("skylark-utils/noder",["./skylark","./langx","./browser","./styler"],function(e,t,n,r){function i(e,n){return t.isArrayLike(e)||(e=[e]),n&&(e=B.call(e,function(e){return e.cloneNode(!0)})),t.flatten(e)}function s(e,t){var n=e.nodeName&&e.nodeName.toLowerCase();return void 0!==t?n===t.toLowerCase():n}function a(e,t,n){var r=e,s=r.parentNode;if(s)for(var a=i(t,n),r=r.nextSibling,o=0;o<a.length;o++)r?s.insertBefore(a[o],r):s.appendChild(a[o]);
return this}function o(e,t,n){for(var r=e,s=i(t,n),a=0;a<s.length;a++)r.appendChild(s[a]);return this}function u(e,t,n){var r=e,s=r.parentNode;if(s)for(var a=i(t,n),o=0;o<a.length;o++)s.insertBefore(a[o],r);return this}function l(e){return s(e,"iframe")?e.contentDocument:e.childNodes}function c(e,t,n){var r=document.createElement(e);if(t)for(var i in t)r.setAttribute(i,t[i]);return n&&o(n,r),r}function f(e){if(e=t.trim(e),I.test(e))return[c(RegExp.$1)];var n=P.test(e)&&RegExp.$1;n in z||(n="*");var r=z[n];return r.innerHTML=""+e,dom=W.call(r.childNodes),dom.forEach(function(e){r.removeChild(e)}),dom}function h(e,t){var n,r=this;return!L||1!==e.nodeType||t?e.cloneNode(t):t?void 0:(n=document.createElement(e.nodeName),each(r.getAttribs(e),function(t){r.setAttrib(n,t.nodeName,r.getAttrib(e,t.nodeName))}),n)}function p(e,t){return g(t,e)}function d(e){return document.createTextNode(e)}function _(){return document}function v(e){for(;e.hasChildNodes();){var t=e.firstChild;e.removeChild(t)}return this}function y(e){if(e===!1)n.exitFullScreen.apply(document);else{if(!e)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.requestFullScreen.apply(e),X=e}}function m(e,n){if(void 0===n)return e.innerHTML;if(this.empty(e),n=n||"",t.isString(n)||t.isNumber(n))e.innerHTML=n;else if(t.isArrayLike(n))for(var r=0;r<n.length;r++)e.appendChild(n[r]);else e.appendChild(n)}function g(e,t,n){if(n)return e.parentNode===t;if(document.documentElement.contains)return t.contains(e);for(;e;){if(t===e)return!0;e=e.parentNode}return!1}function b(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function x(e){return e?9==e.nodeType?e:e.ownerDocument:document}function E(e){var t=x(e);return t.defaultView||t.parentWindow}function T(e,t,n){for(var r=e,s=r.firstChild,a=i(t,n),o=0;o<a.length;o++)s?r.insertBefore(a[o],s):r.appendChild(a[o]);return this}function k(e){for(var t=e.offsetParent||document.body;t&&!U.test(t.nodeName)&&"static"==r.css(t,"position");)t=t.offsetParent;return t}function w(e,t){var n=c("div",t);return r.css(n,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2147483647,opacity:.7}),e.appendChild(n),n}function S(e){if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(t){console.warn("The node is already removed",t)}return this}function A(e,t){return t.parentNode.replaceChild(e,t),this}function R(e,t){t=t||{};var n,r=this,i=t.text,s=t.style,a=t.time,o=t.callback,u=this.createElement("div",{className:t.className||"throbber",style:s}),l=(w(u,{className:"overlay fade"}),this.createElement("div",{className:"throb"})),c=this.createTextNode(i||""),f=function(){n&&(clearTimeout(n),n=null),u&&(r.remove(u),u=null)},h=function(e){e&&e.text&&u&&(c.nodeValue=e.text)};l.appendChild(c),u.appendChild(l),e.appendChild(u);var p=function(){f(),o&&o()};return a&&(n=setTimeout(p,a)),{remove:f,update:h}}function O(e,t){t(e);for(var n=0,r=e.childNodes.length;n<r;n++)O(e.childNodes[n],t);return this}function K(e){for(var t=e.firstChild,n=e.children.length-1;n>0;n--)if(n>0){var r=e.children[n];e.insertBefore(r,t)}}function N(e,n){t.isString(n)&&(n=this.createFragment(n).firstChild),e.parentNode.insertBefore(n,e),n.appendChild(e)}function C(e,t){var n=W.call(e.childNodes);e.appendChild(t);for(var r=0;r<n.length;r++)t.appendChild(n[r]);return this}function D(e){var t=e.parentNode;if(t){if(this.isDoc(t.parentNode))return;t.parentNode.insertBefore(e,t)}}function j(){return j}var L=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),P=/^\s*<(\w+|!)[^>]*>/,I=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,F=document.createElement("div"),q=document.createElement("table"),M=document.createElement("tbody"),V=document.createElement("tr"),z={tr:M,tbody:q,thead:q,tfoot:q,td:V,th:V,"*":F},U=/^(?:body|html)$/i,B=Array.prototype.map,W=Array.prototype.slice,X=null;return t.mixin(j,{body:function(){return document.body},clone:h,contents:l,createElement:c,createFragment:f,contains:p,createTextNode:d,doc:_,empty:v,fullScreen:y,html:m,isChildOf:g,isDoc:b,isWindow:t.isWindow,offsetParent:k,ownerDoc:x,ownerWindow:E,after:a,before:u,prepend:T,append:o,remove:S,replace:A,throb:R,traverse:O,reverse:K,wrapper:N,wrapperInner:C,unwrap:D}),e.noder=j}),define("skylark-utils/css",["./skylark","./langx","./noder"],function(e,t,n){function r(e,r){var i,s={type:"text/css"},a=y++;return r=r||{},r.media&&(s.media=r.media),i=e?n.create("link",t.mixin(s,{rel:"stylesheet",async:!1})):n.createElement("style",s),n.append(v,i),m[a]={id:a,node:i},a}function i(e,t){t||(t={});var n=r(!1,t);return e&&f(n,e),n}function s(e,n){var r=m[e];return t.isNumber(n)?E.call(r,n):t.each(r[x],function(e,t){if(n===t)return E.call(r,e),!1}),this}function a(e){return s(g,e),this}function o(e){if(e===g)throw new Error("The default stylesheet can not be deleted");var t=m[e];return delete m[e],n.remove(t.node),this}function u(e,t,n){return this.insertSheetRule(g,e,t,n)}function l(e){return this.addRules(g,e)}function c(e,t,n,r){if(!t||!n)return-1;var i=m[e];return r=r||i[x].length,_.call(i,t,n,r)}function f(e,r){var i,s=m[e];return i=t.isString(r)?r:p(r),n.append(s.node,n.createTextNode(i)),this}function h(e){return e.startsWith("@")}function p(e){var n=function(e,t,n){return e&&(h(e)?n+=1:t=e+" "+t),{name:t,depth:n}},r=function(e,i,s){var a="",o=h(e);if(h(e))t.isString(i)?a=d.SPACE.repeat(s)+e.trim()+' "'+i.trim()+' ";\n':(a+=d.SPACE.repeat(s)+e.trim()+" {\n",a+=r("",i,s+1),a+=d.SPACE.repeat(s)+" }\n");else if(t.isString(i))a=d.SPACE.repeat(s)+e.trim(),a=o?a+' "'+i.trim()+' ";\n':a+": "+i.trim()+";\n";else if(t.isArray(i))for(var u=0;u<i.length;u++)a+=r(e,i[u],s);else{if(e){a+=d.SPACE.repeat(s)+e.trim()+" {\n";for(var u in i){var l=i[u];t.isString(l)&&(a+=r(u,l,s+1))}a+=d.SPACE.repeat(s)+"}\n"}for(var u in i){var l=i[u];if(!t.isString(l)){var c=n(e,u,s);a+=r(c.name,l,c.depth)}}}return a};return r("",e,0)}function d(){return d}var _,v=document.getElementsByTagName("head")[0],y=0,m={},g=r(),b=m[g],x="cssRules"in b?"cssRules":"rules",E=b.deleteRule||b.removeRule;if(b.insertRule){var T=b.insertRule;_=function(e,t,n){T.call(this,e+"{"+t+"}",n)}}else _=b.addRule;return t.mixin(d,{SPACE:"\t",addRules:l,addSheetRules:f,createStyleSheet:i,deleteSheetRule:s,deleteRule:a,insertRule:u,insertSheetRule:c,removeStyleSheet:o,toString:p}),e.css=d}),define("skylark-utils-css/css",["skylark-utils/skylark","skylark-utils/css"],function(e,t){return t}),define("skylark-utils-css/primitives/beautify-css",[],function(){function e(t,n){function r(){return m=t.charAt(++b),m||""}function i(e){var n=b;return e&&o(),result=t.charAt(b+1)||"",b=n-1,r(),result}function s(e){for(var n=b;r();)if("\\"===m)r();else{if(e.indexOf(m)!==-1)break;if("\n"===m)break}return t.substring(n,b+1)}function a(e){var t=b,n=s(e);return b=t-1,r(),n}function o(){for(var e="";g.test(i());)r(),e+=m;return e}function u(){var e="";for(m&&g.test(m)&&(e=m);g.test(r());)e+=m;return e}function l(e){var n=b,e="/"===i();for(r();r();){if(!e&&"*"===m&&"/"===i()){r();break}if(e&&"\n"===m)return t.substring(n,b)}return t.substring(n,b)+m}function c(e){return t.substring(b-e.length,b).toLowerCase()===e}function f(){for(var e=b+1;e<t.length;e++){var n=t.charAt(e);if("{"===n)return!0;if(";"===n||"}"===n||")"===n)return!1}return!1}function h(){T++,x+=E}function p(){T--,x=x.slice(0,-d)}n=n||{};var d=n.indent_size||4,_=n.indent_char||" ",v=void 0===n.selector_separator_newline||n.selector_separator_newline,y=void 0!==n.end_with_newline&&n.end_with_newline;"string"==typeof d&&(d=parseInt(d,10));var m,g=/^\s+$/,b=-1,x=t.match(/^[\t ]*/)[0],E=new Array(d+1).join(_),T=0,k=0,w={};w["{"]=function(e){w.singleSpace(),S.push(e),w.newLine()},w["}"]=function(e){w.newLine(),S.push(e),w.newLine()},w._lastCharWhitespace=function(){return g.test(S[S.length-1])},w.newLine=function(e){e||w.trim(),S.length&&S.push("\n"),x&&S.push(x)},w.singleSpace=function(){S.length&&!w._lastCharWhitespace()&&S.push(" ")},w.trim=function(){for(;w._lastCharWhitespace();)S.pop()};var S=[];x&&S.push(x);for(var A=!1,R=!1,O="",K="";;){var N=u(),C=""!==N,D=N.indexOf("\n")!==-1,K=O,O=m;if(!m)break;if("/"===m&&"*"===i()){var j=c("");w.newLine(),S.push(l()),w.newLine(),j&&w.newLine(!0)}else if("/"===m&&"/"===i())D||"{"===K||w.trim(),w.singleSpace(),S.push(l()),w.newLine();else if("@"===m){C&&w.singleSpace(),S.push(m);var L=a(": ,;{}()[]/='\"").replace(/\s$/,"");L in e.NESTED_AT_RULE?(k+=1,L in e.CONDITIONAL_GROUP_RULE&&(R=!0)):": ".indexOf(L[L.length-1])>=0&&(r(),L=s(": ").replace(/\s$/,""),S.push(L),w.singleSpace())}else"{"===m?"}"===i(!0)?(o(),r(),w.singleSpace(),S.push("{}")):(h(),w["{"](m),R?(R=!1,A=T>k):A=T>=k):"}"===m?(p(),w["}"](m),A=!1,k&&k--):":"===m?(o(),!A&&!R||c("&")||f()?":"===i()?(r(),S.push("::")):S.push(":"):(S.push(":"),w.singleSpace())):'"'===m||"'"===m?(C&&w.singleSpace(),S.push(s(m))):";"===m?(S.push(m),w.newLine()):"("===m?c("url")?(S.push(m),o(),r()&&(")"!==m&&'"'!==m&&"'"!==m?S.push(s(")")):b--)):(C&&w.singleSpace(),S.push(m),o()):")"===m?S.push(m):","===m?(S.push(m),o(),!A&&v?w.newLine():w.singleSpace()):"]"===m?S.push(m):"["===m?(C&&w.singleSpace(),S.push(m)):"="===m?(o(),S.push(m)):(C&&w.singleSpace(),S.push(m))}var P=S.join("").replace(/[\r\n\t ]+$/,"");return y&&(P+="\n"),P}return e.NESTED_AT_RULE={"@page":!0,"@font-face":!0,"@keyframes":!0,"@media":!0,"@supports":!0,"@document":!0},e.CONDITIONAL_GROUP_RULE={"@media":!0,"@supports":!0,"@document":!0},{css_beautify:e}}),define("skylark-utils-css/beautify",["./css","./primitives/beautify-css"],function(e,t){return e.beautify=t.css_beautify}),define("skylark-utils/finder",["./skylark","./langx","./browser","./noder"],function(e,t,n,r,s){function a(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function o(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e,n,r){for(var i=r&&t.isString(r);e=e.parentNode;){if(g(e,n))return e;if(r)if(i){if(g(e,r))break}else if(e==r)break}return null}function l(e,n,r){for(var i=[],s=r&&t.isString(r);(e=e.parentNode)&&9!==e.nodeType;)if(i.push(e),r)if(s){if(g(e,r))break}else if(e==r)break;return n&&(i=S.filter(i,n)),i}function c(e,t){return t=t||r.doc(),t.getElementById(e)}function f(e,t){for(var n=e.childNodes,r=[],i=0;i<n.length;i++){var e=n[i];1==e.nodeType&&r.push(e)}return t&&(r=S.filter(r,t)),r}function h(e,t){for(;e&&!g(e,t);)e=e.parentNode;return e}function p(e,t){try{return R.call(e.querySelectorAll(t))}catch(n){}return S.query(e,t)}function d(e,t){try{return e.querySelector(t)}catch(n){}var r=S.query(e,t);return r.length>0?r[0]:null}function _(e,t){return t||(t=e,e=document.body),g(e,t)?e:d(e,t)}function v(e,t){return t||(t=e,e=document.body),p(e,t)}function y(e,t,n){for(var r=e.childNodes,i=r[0];i;){if(1==i.nodeType){if(!t||g(i,t))return i;if(n)break}i=i.nextSibling}return null}function m(e,t,n){for(var r=e.childNodes,i=r[r.length-1];i;){if(1==i.nodeType){if(!t||g(i,t))return i;if(n)break}i=i.previousSibling}return null}function g(e,n){if(!n||!e||1!==e.nodeType)return!1;if(t.isString(n)){try{return O.call(e,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(r){}return S.match(e,n)}return t.isArrayLike(n)?t.inArray(e,n)>-1:t.isPlainObject(n)?S.check(e,n):e===n}function b(e,t,n){for(var r=e.nextSibling;r;){if(1==r.nodeType){if(!t||g(r,t))return r;if(n)break}r=r.nextSibling}return null}function x(e,t){for(var n=e.nextSibling,r=[];n;)1==n.nodeType&&(t&&!g(n,t)||r.push(n)),n=n.nextSibling;return r}function E(e,t){var n=e.parentNode;return!n||t&&!g(n,t)?null:n}function T(e,t,n){for(var r=e.previousSibling;r;){if(1==r.nodeType){if(!t||g(r,t))return r;if(n)break}r=r.previousSibling}return null}function k(e,t){for(var n=e.previousSibling,r=[];n;)1==n.nodeType&&(t&&!g(n,t)||r.push(n)),n=n.previousSibling;return r}function w(e,t){for(var n=e.parentNode.firstChild,r=[];n;)1==n.nodeType&&n!==e&&(t&&!g(n,t)||r.push(n)),n=n.nextSibling;return r}var S={},A=Array.prototype.filter,R=Array.prototype.slice,O=n.matchesSelector;(function(){function e(e,s,a,u,c,h,p,d,_,v,y,m,g,b,x,E){if((s||n===-1)&&(t.expressions[++n]=[],r=-1,s))return"";if(a||u||r===-1){a=a||" ";var T=t.expressions[n];i&&T[r]&&(T[r].reverseCombinator=l(a)),T[++r]={combinator:a,tag:"*"}}var k=t.expressions[n][r];if(c)k.tag=c.replace(o,"");else if(h)k.id=h.replace(o,"");else if(p)p=p.replace(o,""),k.classList||(k.classList=[]),k.classes||(k.classes=[]),k.classList.push(p),k.classes.push({value:p,regexp:new RegExp("(^|\\s)"+f(p)+"(\\s|$)")});else if(g)E=E||x,E=E?E.replace(o,""):null,k.pseudos||(k.pseudos=[]),k.pseudos.push({key:g.replace(o,""),value:E,type:1==m.length?"class":"element"});else if(d){d=d.replace(o,""),y=(y||"").replace(o,"");var w,S;switch(_){case"^=":S=new RegExp("^"+f(y));break;case"$=":S=new RegExp(f(y)+"$");break;case"~=":S=new RegExp("(^|\\s)"+f(y)+"(\\s|$)");break;case"|=":S=new RegExp("^"+f(y)+"(-|$)");break;case"=":w=function(e){return y==e};break;case"*=":w=function(e){return e&&e.indexOf(y)>-1};break;case"!=":w=function(e){return y!=e};break;default:w=function(e){return!!e}}""==y&&/^[*$^]=$/.test(_)&&(w=function(){return!1}),w||(w=function(e){return e&&S.test(e)}),k.attributes||(k.attributes=[]),k.attributes.push({key:d,operator:_,value:y,test:w})}return""}var t,n,r,i,s={},a={},o=/\\/g,u=function(r,o){if(null==r)return null;if(r.Slick===!0)return r;r=(""+r).replace(/^\s+|\s+$/g,""),i=!!o;var l=i?a:s;if(l[r])return l[r];for(t={Slick:!0,expressions:[],raw:r,reverse:function(){return u(this.raw,!0)}},n=-1;r!=(r=r.replace(h,e)););return t.length=t.expressions.length,l[t.raw]=i?c(t):t},l=function(e){return"!"===e?" ":" "===e?"!":/^!/.test(e)?e.replace(/^!/,""):"!"+e},c=function(e){for(var t=e.expressions,n=0;n<t.length;n++){for(var r=t[n],i={parts:[],tag:"*",combinator:l(r[0].combinator)},s=0;s<r.length;s++){var a=r[s];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}r.reverse().push(i)}return e},f=function(){var e=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,t="\\";return function(n){return n.replace(e,t)}}(),h=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+f(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),p=this.Slick||{};p.parse=function(e){return u(e)},p.escapeRegExp=f,this.Slick||(this.Slick=p)}).apply(S);var K=/^(?:input|select|textarea|button)$/i,N=/^h\d$/i,R=Array.prototype.slice;S.parseSelector=S.Slick.parse;var C=S.pseudos={button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},checked:function(e){return!!e.checked},contains:function(e,t,n,r){if($(this).text().indexOf(r)>-1)return this},disabled:function(e){return!!e.disabled},enabled:function(e){return!e.disabled},eq:function(e,t,n,r){return t==r},even:function(e,t,n,r){return t%2===0},focus:function(e){return document.activeElement===e&&(e.href||e.type||e.tabindex)},first:function(e,t){return 0===t},gt:function(e,t,n,r){return t>r},has:function(e,t,n,r){return _(e,r)},header:function(e){return N.test(e.nodeName)},hidden:function(e){return!S.pseudos.visible(e)},input:function(e){return K.test(e.nodeName)},last:function(e,t,n){return t===n.length-1},lt:function(e,t,n,r){return t<r},not:function(e,t,n,r){return!g(e,r)},odd:function(e,t,n,r){return t%2===1},parent:function(e){return!!e.parentNode},selected:function(e){return!!e.selected},text:function(e){return"text"===e.type},visible:function(e){return e.offsetWidth&&e.offsetWidth}};["first","eq","last"].forEach(function(e){C[e].isArrayFilter=!0}),C.nth=C.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C[i]=a(i);for(i in{submit:!0,reset:!0})C[i]=o(i);S.divide=function(e){var t,n,r,i,s,a="",o=[];if((n=e.id)&&(a+="#"+n),r=e.classes)for(var u=r.length;u--;)a+="."+r[u].value;if(i=e.attributes)for(var u=0;u<i.length;u++)a+=i[u].operator?"["+i[u].key+i[u].operator+JSON.stringify(i[u].value)+"]":"["+i[u].key+"]";if(s=e.pseudos)for(u=s.length;u--;)part=s[u],this.pseudos[part.key]?o.push(part):void 0!==part.value&&(a+=":"+part.key+"("+JSON.stringify(part));return(t=e.tag)&&"*"!==t&&(a=t.toUpperCase()+a),a||(a="*"),{nativeSelector:a,customPseudos:o}},S.check=function(e,t,n,r,i){var s,a,o,u,l,c,f,h,p;if(!i){if(s=t.tag){var d=e.nodeName.toUpperCase();if("*"==s){if(d<"@")return!1}else if(d!=(s||"").toUpperCase())return!1}if((a=t.id)&&e.getAttribute("id")!=a)return!1;if(o=t.classes)for(c=o.length;c--;)if(h=e.getAttribute("class"),!h||!o[c].regexp.test(h))return!1;if(u=t.attributes)for(c=u.length;c--;)if(f=u[c],f.operator?!f.test(e.getAttribute(f.key)):!e.hasAttribute(f.key))return!1}if(l=t.pseudos)for(c=l.length;c--;)if(f=l[c],p=this.pseudos[f.key]){if((i&&p.isArrayFilter||!i&&!p.isArrayFilter)&&!p(e,n,r,f.value))return!1}else if(!i&&!O.call(e,f.key))return!1;return!0},S.match=function(e,n){var r;if(r=t.isString(n)?S.Slick.parse(n):n,!r)return!0;var i,s,a=r.expressions,o=0;for(i=0;s=a[i];i++)if(1==s.length){var u=s[0];if(this.check(e,u))return!0;o++}if(o==r.length)return!1;var l,c=this.query(document,r);for(i=0;l=c[i++];)if(l===e)return!0;return!1},S.filterSingle=function(e,t){var n=A.call(e,function(n,r){return S.check(n,t,r,e,!1)});return n=A.call(n,function(e,r){return S.check(e,t,r,n,!0)})},S.filter=function(e,n){var r;if(!t.isString(n))return S.filterSingle(e,n);r=S.Slick.parse(n);var i,s,a=r.expressions,o=[];for(i=0;s=a[i];i++){if(1!=s.length)throw new Error("not supported selector:"+n);var u=s[0],l=S.filterSingle(e,u);o=t.uniq(o.concat(l))}return o},S.combine=function(e,t){var n,r=t.combinator,i=t,s=[];switch(r){case">":s=f(e,i);break;case"+":n=b(e,i,!0),n&&s.push(n);break;case"^":n=y(e,i,!0),n&&s.push(n);break;case"~":s=x(e,i);break;case"++":var a=T(e,i,!0),o=b(e,i,!0);a&&s.push(a),o&&s.push(o);break;case"~~":s=w(e,i);break;case"!":s=l(e,i);break;case"!>":n=E(e,i),n&&s.push(n);break;case"!+":s=T(e,i,!0);break;case"!^":n=m(e,i,!0),n&&s.push(n);break;case"!~":s=k(e,i);break;default:var u=this.divide(t);if(s=R.call(e.querySelectorAll(u.nativeSelector)),u.customPseudos)for(var c=u.customPseudos.length-1;c>=0;c--)s=A.call(s,function(e,t){return S.check(e,{pseudos:[u.customPseudos[c]]},t,s,!1)}),s=A.call(s,function(e,t){return S.check(e,{pseudos:[u.customPseudos[c]]},t,s,!0)})}return s},S.query=function(e,n,r){for(var i,s,a=this.Slick.parse(n),o=[],u=a.expressions,l=0;i=u[l];l++){for(var c,f=[e],h=0;s=i[h];h++)c=t.map(f,function(e,t){return S.combine(e,s)}),c&&(f=c);c&&(o=o.concat(c))}return o};var D=function(){return D};return t.mixin(D,{ancestor:u,ancestors:l,byId:c,children:f,closest:h,descendant:d,descendants:p,find:_,findAll:v,firstChild:y,lastChild:m,matches:g,nextSibling:b,nextSiblings:x,parent:E,previousSibling:T,previousSiblings:k,pseudos:S.pseudos,siblings:w}),e.finder=D}),define("skylark-utils/scripter",["./skylark","./langx","./noder","./finder"],function(e,t,n,r){function i(){return i}var s=document.getElementsByTagName("head")[0],a={},o={},u=0;return t.mixin(i,{loadJavaScript:function(e,t,n){var r=a[e];if(r||(r=a[e]={state:0,loadedCallbacks:[],errorCallbacks:[]}),r.loadedCallbacks.push(t),r.errorCallbacks.push(n),1===r.state)r.node.onload();else if(r.state===-1)r.node.onerror();else{var i=r.node=document.createElement("script"),l=r.id=u++;i.type="text/javascript",i.async=!1,i.defer=!1,startTime=(new Date).getTime(),s.appendChild(i),i.onload=function(){r.state=1;for(var e=r.loadedCallbacks,t=e.length;t--;)e[t]();r.loadedCallbacks=[],r.errorCallbacks=[]},i.onerror=function(){r.state=-1;for(var e=r.errorCallbacks,t=e.length;t--;)e[t]();r.loadedCallbacks=[],r.errorCallbacks=[]},i.src=e,o[l]=i}return r.id},deleteJavaScript:function(e){var t=o[e];if(t){var r=t.src;n.remove(t),delete o[e],delete a[r]}}}),e.scripter=i}),define("skylark-utils-js/js",["skylark-utils/skylark","skylark-utils/scripter"],function(e,t){return t}),define("skylark-utils-js/primitives/beautify-js",[],function(){function e(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function t(e){return e.replace(/^\s+|\s+$/g,"")}function n(e,t){"use strict";var n=new r(e,t);return n.beautify()}function r(n,r){"use strict";function i(e,t){var n=0;e&&(n=e.indentation_level,!z.just_added_newline()&&e.line_indent_level>n&&(n=e.line_indent_level));var r={mode:t,parent:e,last_text:e?e.last_text:"",last_word:e?e.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:n,line_indent_level:e?e.line_indent_level:n,start_line_index:z.get_line_number(),ternary_depth:0};return r}function o(e){var t=e.newlines,n=ee.keep_array_indentation&&y(Q.mode);if(n)for(r=0;r<t;r+=1)f(r>0);else if(ee.max_preserve_newlines&&t>ee.max_preserve_newlines&&(t=ee.max_preserve_newlines),ee.preserve_newlines&&e.newlines>1){f();for(var r=1;r<t;r+=1)f(!0)}W=e,Y[W.type]()}function l(e){e=e.replace(/\x0d/g,"");for(var t=[],n=e.indexOf("\n");n!==-1;)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function c(e){if(e=void 0!==e&&e,!z.just_added_newline())if(ee.preserve_newlines&&W.wanted_newline||e)f(!1,!0);else if(ee.wrap_line_length){var t=z.current_line.get_character_count()+W.text.length+(z.space_before_token?1:0);t>=ee.wrap_line_length&&f(!1,!0)}}function f(e,t){if(!t&&";"!==Q.last_text&&","!==Q.last_text&&"="!==Q.last_text&&"TK_OPERATOR"!==X)for(;Q.mode===u.Statement&&!Q.if_block&&!Q.do_block;)g();z.add_new_line(e)&&(Q.multiline_frame=!0)}function h(){z.just_added_newline()&&(ee.keep_array_indentation&&y(Q.mode)&&W.wanted_newline?(z.current_line.push(W.whitespace_before),z.space_before_token=!1):z.set_indent(Q.indentation_level)&&(Q.line_indent_level=Q.indentation_level))}function p(e){e=e||W.text,h(),z.add_token(e)}function d(){Q.indentation_level+=1}function _(){Q.indentation_level>0&&(!Q.parent||Q.indentation_level>Q.parent.indentation_level)&&(Q.indentation_level-=1)}function v(e){Q?(J.push(Q),H=Q):H=i(null,e),Q=i(H,e)}function y(e){return e===u.ArrayLiteral}function m(t){return e(t,[u.Expression,u.ForInitializer,u.Conditional])}function g(){J.length>0&&(H=Q,Q=J.pop(),H.mode===u.Statement&&z.remove_redundant_indentation(H))}function b(){return Q.parent.mode===u.ObjectLiteral&&Q.mode===u.Statement&&(":"===Q.last_text&&0===Q.ternary_depth||"TK_RESERVED"===X&&e(Q.last_text,["get","set"]))}function x(){return!!("TK_RESERVED"===X&&e(Q.last_text,["var","let","const"])&&"TK_WORD"===W.type||"TK_RESERVED"===X&&"do"===Q.last_text||"TK_RESERVED"===X&&"return"===Q.last_text&&!W.wanted_newline||"TK_RESERVED"===X&&"else"===Q.last_text&&("TK_RESERVED"!==W.type||"if"!==W.text)||"TK_END_EXPR"===X&&(H.mode===u.ForInitializer||H.mode===u.Conditional)||"TK_WORD"===X&&Q.mode===u.BlockStatement&&!Q.in_case&&"--"!==W.text&&"++"!==W.text&&"TK_WORD"!==W.type&&"TK_RESERVED"!==W.type||Q.mode===u.ObjectLiteral&&(":"===Q.last_text&&0===Q.ternary_depth||"TK_RESERVED"===X&&e(Q.last_text,["get","set"])))&&(v(u.Statement),d(),"TK_RESERVED"===X&&e(Q.last_text,["var","let","const"])&&"TK_WORD"===W.type&&(Q.declaration_statement=!0),b()||c("TK_RESERVED"===W.type&&e(W.text,["do","for","if","while"])),!0)}function E(e,n){for(var r=0;r<e.length;r++){var i=t(e[r]);if(i.charAt(0)!==n)return!1}return!0}function T(e,t){for(var n,r=0,i=e.length;r<i;r++)if(n=e[r],n&&0!==n.indexOf(t))return!1;return!0}function k(t){return e(t,["case","return","do","if","throw","else"])}function w(e){var t=U+(e||0);return t<0||t>=te.length?null:te[t]}function S(){x();var t=u.Expression;if("["===W.text){if("TK_WORD"===X||")"===Q.last_text)return"TK_RESERVED"===X&&e(Q.last_text,B.line_starters)&&(z.space_before_token=!0),v(t),p(),d(),void(ee.space_in_paren&&(z.space_before_token=!0));t=u.ArrayLiteral,y(Q.mode)&&("["!==Q.last_text&&(","!==Q.last_text||"]"!==$&&"}"!==$)||ee.keep_array_indentation||f())}else"TK_RESERVED"===X&&"for"===Q.last_text?t=u.ForInitializer:"TK_RESERVED"===X&&e(Q.last_text,["if","while"])&&(t=u.Conditional);";"===Q.last_text||"TK_START_BLOCK"===X?f():"TK_END_EXPR"===X||"TK_START_EXPR"===X||"TK_END_BLOCK"===X||"."===Q.last_text?c(W.wanted_newline):"TK_RESERVED"===X&&"("===W.text||"TK_WORD"===X||"TK_OPERATOR"===X?"TK_RESERVED"===X&&("function"===Q.last_word||"typeof"===Q.last_word)||"*"===Q.last_text&&"function"===$?ee.space_after_anon_function&&(z.space_before_token=!0):"TK_RESERVED"!==X||!e(Q.last_text,B.line_starters)&&"catch"!==Q.last_text||ee.space_before_conditional&&(z.space_before_token=!0):z.space_before_token=!0,"("===W.text&&("TK_EQUALS"!==X&&"TK_OPERATOR"!==X||b()||c()),v(t),p(),ee.space_in_paren&&(z.space_before_token=!0),d()}function A(){for(;Q.mode===u.Statement;)g();Q.multiline_frame&&c("]"===W.text&&y(Q.mode)&&!ee.keep_array_indentation),ee.space_in_paren&&("TK_START_EXPR"!==X||ee.space_in_empty_paren?z.space_before_token=!0:(z.trim(),z.space_before_token=!1)),"]"===W.text&&ee.keep_array_indentation?(p(),g()):(g(),p()),z.remove_redundant_indentation(H),Q.do_while&&H.mode===u.Conditional&&(H.mode=u.Expression,Q.do_block=!1,Q.do_while=!1)}function R(){var t=w(1),n=w(2);v(n&&(":"===n.text&&e(t.type,["TK_STRING","TK_WORD","TK_RESERVED"])||e(t.text,["get","set"])&&e(n.type,["TK_WORD","TK_RESERVED"]))?e($,["class","interface"])?u.BlockStatement:u.ObjectLiteral:u.BlockStatement);var r=!t.comments_before.length&&"}"===t.text,i=r&&"function"===Q.last_word&&"TK_END_EXPR"===X;"expand"===ee.brace_style||"none"===ee.brace_style&&W.wanted_newline?"TK_OPERATOR"!==X&&(i||"TK_EQUALS"===X||"TK_RESERVED"===X&&k(Q.last_text)&&"else"!==Q.last_text)?z.space_before_token=!0:f(!1,!0):"TK_OPERATOR"!==X&&"TK_START_EXPR"!==X?"TK_START_BLOCK"===X?f():z.space_before_token=!0:y(H.mode)&&","===Q.last_text&&("}"===$?z.space_before_token=!0:f()),p(),d()}function O(){for(;Q.mode===u.Statement;)g();var e="TK_START_BLOCK"===X;"expand"===ee.brace_style?e||f():e||(y(Q.mode)&&ee.keep_array_indentation?(ee.keep_array_indentation=!1,f(),ee.keep_array_indentation=!0):f()),g(),p()}function K(){if("TK_RESERVED"===W.type&&Q.mode!==u.ObjectLiteral&&e(W.text,["set","get"])&&(W.type="TK_WORD"),"TK_RESERVED"===W.type&&Q.mode===u.ObjectLiteral){var t=w(1);":"==t.text&&(W.type="TK_WORD")}if(x()||!W.wanted_newline||m(Q.mode)||"TK_OPERATOR"===X&&"--"!==Q.last_text&&"++"!==Q.last_text||"TK_EQUALS"===X||!ee.preserve_newlines&&"TK_RESERVED"===X&&e(Q.last_text,["var","let","const","set","get"])||f(),Q.do_block&&!Q.do_while){if("TK_RESERVED"===W.type&&"while"===W.text)return z.space_before_token=!0,p(),z.space_before_token=!0,void(Q.do_while=!0);f(),Q.do_block=!1}if(Q.if_block)if(Q.else_block||"TK_RESERVED"!==W.type||"else"!==W.text){for(;Q.mode===u.Statement;)g();Q.if_block=!1,Q.else_block=!1}else Q.else_block=!0;if("TK_RESERVED"===W.type&&("case"===W.text||"default"===W.text&&Q.in_case_statement))return f(),(Q.case_body||ee.jslint_happy)&&(_(),Q.case_body=!1),p(),Q.in_case=!0,void(Q.in_case_statement=!0);if("TK_RESERVED"===W.type&&"function"===W.text&&((e(Q.last_text,["}",";"])||z.just_added_newline()&&!e(Q.last_text,["[","{",":","=",","]))&&(z.just_added_blankline()||W.comments_before.length||(f(),f(!0))),"TK_RESERVED"===X||"TK_WORD"===X?"TK_RESERVED"===X&&e(Q.last_text,["get","set","new","return","export"])?z.space_before_token=!0:"TK_RESERVED"===X&&"default"===Q.last_text&&"export"===$?z.space_before_token=!0:f():"TK_OPERATOR"===X||"="===Q.last_text?z.space_before_token=!0:(Q.multiline_frame||!m(Q.mode)&&!y(Q.mode))&&f()),"TK_COMMA"!==X&&"TK_START_EXPR"!==X&&"TK_EQUALS"!==X&&"TK_OPERATOR"!==X||b()||c(),"TK_RESERVED"===W.type&&e(W.text,["function","get","set"]))return p(),void(Q.last_word=W.text);if(Z="NONE","TK_END_BLOCK"===X?"TK_RESERVED"===W.type&&e(W.text,["else","catch","finally"])?"expand"===ee.brace_style||"end-expand"===ee.brace_style||"none"===ee.brace_style&&W.wanted_newline?Z="NEWLINE":(Z="SPACE",z.space_before_token=!0):Z="NEWLINE":"TK_SEMICOLON"===X&&Q.mode===u.BlockStatement?Z="NEWLINE":"TK_SEMICOLON"===X&&m(Q.mode)?Z="SPACE":"TK_STRING"===X?Z="NEWLINE":"TK_RESERVED"===X||"TK_WORD"===X||"*"===Q.last_text&&"function"===$?Z="SPACE":"TK_START_BLOCK"===X?Z="NEWLINE":"TK_END_EXPR"===X&&(z.space_before_token=!0,Z="NEWLINE"),"TK_RESERVED"===W.type&&e(W.text,B.line_starters)&&")"!==Q.last_text&&(Z="else"===Q.last_text||"export"===Q.last_text?"SPACE":"NEWLINE"),"TK_RESERVED"===W.type&&e(W.text,["else","catch","finally"]))if("TK_END_BLOCK"!==X||"expand"===ee.brace_style||"end-expand"===ee.brace_style||"none"===ee.brace_style&&W.wanted_newline)f();else{z.trim(!0);var n=z.current_line;"}"!==n.last()&&f(),z.space_before_token=!0}else"NEWLINE"===Z?"TK_RESERVED"===X&&k(Q.last_text)?z.space_before_token=!0:"TK_END_EXPR"!==X?"TK_START_EXPR"===X&&"TK_RESERVED"===W.type&&e(W.text,["var","let","const"])||":"===Q.last_text||("TK_RESERVED"===W.type&&"if"===W.text&&"else"===Q.last_text?z.space_before_token=!0:f()):"TK_RESERVED"===W.type&&e(W.text,B.line_starters)&&")"!==Q.last_text&&f():Q.multiline_frame&&y(Q.mode)&&","===Q.last_text&&"}"===$?f():"SPACE"===Z&&(z.space_before_token=!0);p(),Q.last_word=W.text,"TK_RESERVED"===W.type&&"do"===W.text&&(Q.do_block=!0),"TK_RESERVED"===W.type&&"if"===W.text&&(Q.if_block=!0)}function N(){for(x()&&(z.space_before_token=!1);Q.mode===u.Statement&&!Q.if_block&&!Q.do_block;)g();p()}function C(){x()?z.space_before_token=!0:"TK_RESERVED"===X||"TK_WORD"===X?z.space_before_token=!0:"TK_COMMA"===X||"TK_START_EXPR"===X||"TK_EQUALS"===X||"TK_OPERATOR"===X?b()||c():f(),p()}function D(){x(),Q.declaration_statement&&(Q.declaration_assignment=!0),z.space_before_token=!0,p(),z.space_before_token=!0}function j(){return Q.declaration_statement?(m(Q.parent.mode)&&(Q.declaration_assignment=!1),p(),void(Q.declaration_assignment?(Q.declaration_assignment=!1,f(!1,!0)):z.space_before_token=!0)):(p(),void(Q.mode===u.ObjectLiteral||Q.mode===u.Statement&&Q.parent.mode===u.ObjectLiteral?(Q.mode===u.Statement&&g(),f()):z.space_before_token=!0))}function L(){if(x(),"TK_RESERVED"===X&&k(Q.last_text))return z.space_before_token=!0,void p();if("*"===W.text&&"TK_DOT"===X)return void p();if(":"===W.text&&Q.in_case)return Q.case_body=!0,d(),p(),f(),void(Q.in_case=!1);if("::"===W.text)return void p();!W.wanted_newline||"--"!==W.text&&"++"!==W.text||f(!1,!0),"TK_OPERATOR"===X&&c();var t=!0,n=!0;e(W.text,["--","++","!","~"])||e(W.text,["-","+"])&&(e(X,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||e(Q.last_text,B.line_starters)||","===Q.last_text)?(t=!1,n=!1,";"===Q.last_text&&m(Q.mode)&&(t=!0),"TK_RESERVED"===X||"TK_END_EXPR"===X?t=!0:"TK_OPERATOR"===X&&(t=e(W.text,["--","-"])&&e(Q.last_text,["--","-"])||e(W.text,["++","+"])&&e(Q.last_text,["++","+"])),Q.mode!==u.BlockStatement&&Q.mode!==u.Statement||"{"!==Q.last_text&&";"!==Q.last_text||f()):":"===W.text?0===Q.ternary_depth?t=!1:Q.ternary_depth-=1:"?"===W.text?Q.ternary_depth+=1:"*"===W.text&&"TK_RESERVED"===X&&"function"===Q.last_text&&(t=!1,n=!1),z.space_before_token=z.space_before_token||t,p(),z.space_before_token=n}function P(){var e,n=l(W.text),r=!1,i=!1,s=W.whitespace_before,a=s.length;for(f(!1,!0),n.length>1&&(E(n.slice(1),"*")?r=!0:T(n.slice(1),s)&&(i=!0)),p(n[0]),e=1;e<n.length;e++)f(!1,!0),r?p(" "+t(n[e])):i&&n[e].length>a?p(n[e].substring(a)):z.add_token(n[e]);f(!1,!0)}function I(){z.space_before_token=!0,p(),z.space_before_token=!0}function F(){W.wanted_newline?f(!1,!0):z.trim(!0),z.space_before_token=!0,p(),f(!1,!0)}function q(){x(),"TK_RESERVED"===X&&k(Q.last_text)?z.space_before_token=!0:c(")"===Q.last_text&&ee.break_chained_methods),p()}function M(){p(),"\n"===W.text[W.text.length-1]&&f()}function V(){for(;Q.mode===u.Statement;)g()}var z,U,B,W,X,$,G,Q,H,J,Z,Y,ee,te=[],ne="";for(Y={TK_START_EXPR:S,TK_END_EXPR:A,TK_START_BLOCK:R,
TK_END_BLOCK:O,TK_WORD:K,TK_RESERVED:K,TK_SEMICOLON:N,TK_STRING:C,TK_EQUALS:D,TK_OPERATOR:L,TK_COMMA:j,TK_BLOCK_COMMENT:P,TK_INLINE_COMMENT:I,TK_COMMENT:F,TK_DOT:q,TK_UNKNOWN:M,TK_EOF:V},r=r?r:{},ee={},void 0!==r.braces_on_own_line&&(ee.brace_style=r.braces_on_own_line?"expand":"collapse"),ee.brace_style=r.brace_style?r.brace_style:ee.brace_style?ee.brace_style:"collapse","expand-strict"===ee.brace_style&&(ee.brace_style="expand"),ee.indent_size=r.indent_size?parseInt(r.indent_size,10):4,ee.indent_char=r.indent_char?r.indent_char:" ",ee.preserve_newlines=void 0===r.preserve_newlines||r.preserve_newlines,ee.break_chained_methods=void 0!==r.break_chained_methods&&r.break_chained_methods,ee.max_preserve_newlines=void 0===r.max_preserve_newlines?0:parseInt(r.max_preserve_newlines,10),ee.space_in_paren=void 0!==r.space_in_paren&&r.space_in_paren,ee.space_in_empty_paren=void 0!==r.space_in_empty_paren&&r.space_in_empty_paren,ee.jslint_happy=void 0!==r.jslint_happy&&r.jslint_happy,ee.space_after_anon_function=void 0!==r.space_after_anon_function&&r.space_after_anon_function,ee.keep_array_indentation=void 0!==r.keep_array_indentation&&r.keep_array_indentation,ee.space_before_conditional=void 0===r.space_before_conditional||r.space_before_conditional,ee.unescape_strings=void 0!==r.unescape_strings&&r.unescape_strings,ee.wrap_line_length=void 0===r.wrap_line_length?0:parseInt(r.wrap_line_length,10),ee.e4x=void 0!==r.e4x&&r.e4x,ee.end_with_newline=void 0!==r.end_with_newline&&r.end_with_newline,ee.jslint_happy&&(ee.space_after_anon_function=!0),r.indent_with_tabs&&(ee.indent_char="\t",ee.indent_size=1),G="";ee.indent_size>0;)G+=ee.indent_char,ee.indent_size-=1;var re=0;if(n&&n.length){for(;" "===n.charAt(re)||"\t"===n.charAt(re);)ne+=n.charAt(re),re+=1;n=n.substring(re)}X="TK_START_BLOCK",$="",z=new s(G,ne),J=[],v(u.BlockStatement),this.beautify=function(){var e,t;for(B=new a(n,ee,G),te=B.tokenize(),U=0;e=w();){for(var r=0;r<e.comments_before.length;r++)o(e.comments_before[r]);o(e),$=Q.last_text,X=e.type,Q.last_text=e.text,U+=1}return t=z.get_code(),ee.end_with_newline&&(t+="\n"),t}}function i(e){var t=0,n=-1,r=[],i=!0;this.set_indent=function(r){t=e.baseIndentLength+r*e.indent_length,n=r},this.get_character_count=function(){return t},this.is_empty=function(){return i},this.last=function(){return this._empty?null:r[r.length-1]},this.push=function(e){r.push(e),t+=e.length,i=!1},this.remove_indent=function(){n>0&&(n-=1,t-=e.indent_length)},this.trim=function(){for(;" "===this.last();){r.pop();t-=1}i=0===r.length},this.toString=function(){var t="";return this._empty||(n>=0&&(t=e.indent_cache[n]),t+=r.join("")),t}}function s(e,t){t=t||"",this.indent_cache=[t],this.baseIndentLength=t.length,this.indent_length=e.length;var n=[];this.baseIndentString=t,this.indent_string=e,this.current_line=null,this.space_before_token=!1,this.get_line_number=function(){return n.length},this.add_new_line=function(e){return(1!==this.get_line_number()||!this.just_added_newline())&&(!(!e&&this.just_added_newline())&&(this.current_line=new i(this),n.push(this.current_line),!0))},this.add_new_line(!0),this.get_code=function(){var e=n.join("\n").replace(/[\r\n\t ]+$/,"");return e},this.set_indent=function(e){if(n.length>1){for(;e>=this.indent_cache.length;)this.indent_cache.push(this.indent_cache[this.indent_cache.length-1]+this.indent_string);return this.current_line.set_indent(e),!0}return this.current_line.set_indent(0),!1},this.add_token=function(e){this.add_space_before_token(),this.current_line.push(e)},this.add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&this.current_line.push(" "),this.space_before_token=!1},this.remove_redundant_indentation=function(e){if(!e.multiline_frame&&e.mode!==u.ForInitializer&&e.mode!==u.Conditional)for(var t=e.start_line_index,r=n.length;t<r;)n[t].remove_indent(),t++},this.trim=function(r){for(r=void 0!==r&&r,this.current_line.trim(e,t);r&&n.length>1&&this.current_line.is_empty();)n.pop(),this.current_line=n[n.length-1],this.current_line.trim()},this.just_added_newline=function(){return this.current_line.is_empty()},this.just_added_blankline=function(){if(this.just_added_newline()){if(1===n.length)return!0;var e=n[n.length-2];return e.is_empty()}return!1}}function a(n,r,i){function s(){var s,g=[];if(h=0,p="",v>=y)return["","TK_EOF"];var b;b=_.length?_[_.length-1]:new l("TK_START_BLOCK","{");var x=n.charAt(v);for(v+=1;e(x,u);){if("\n"===x?(h+=1,g=[]):h&&(x===i?g.push(i):"\r"!==x&&g.push(" ")),v>=y)return["","TK_EOF"];x=n.charAt(v),v+=1}if(g.length&&(p=g.join("")),c.test(x)){var E=!0,T=!0,k=c;for("0"===x&&v<y&&/[Xx]/.test(n.charAt(v))?(E=!1,T=!1,x+=n.charAt(v),v+=1,k=/[0123456789abcdefABCDEF]/):(x="",v-=1);v<y&&k.test(n.charAt(v));)x+=n.charAt(v),v+=1,E&&v<y&&"."===n.charAt(v)&&(x+=n.charAt(v),v+=1,E=!1),T&&v<y&&/[Ee]/.test(n.charAt(v))&&(x+=n.charAt(v),v+=1,v<y&&/[+-]/.test(n.charAt(v))&&(x+=n.charAt(v),v+=1),T=!1,E=!1);return[x,"TK_WORD"]}if(o.isIdentifierStart(n.charCodeAt(v-1))){if(v<y)for(;o.isIdentifierChar(n.charCodeAt(v))&&(x+=n.charAt(v),v+=1,v!==y););return"TK_DOT"===b.type||"TK_RESERVED"===b.type&&e(b.text,["set","get"])||!e(x,m)?[x,"TK_WORD"]:"in"===x?[x,"TK_OPERATOR"]:[x,"TK_RESERVED"]}if("("===x||"["===x)return[x,"TK_START_EXPR"];if(")"===x||"]"===x)return[x,"TK_END_EXPR"];if("{"===x)return[x,"TK_START_BLOCK"];if("}"===x)return[x,"TK_END_BLOCK"];if(";"===x)return[x,"TK_SEMICOLON"];if("/"===x){var w="",S=!0;if("*"===n.charAt(v)){if(v+=1,v<y)for(;v<y&&("*"!==n.charAt(v)||!n.charAt(v+1)||"/"!==n.charAt(v+1))&&(x=n.charAt(v),w+=x,"\n"!==x&&"\r"!==x||(S=!1),v+=1,!(v>=y)););return v+=2,S&&0===h?["/*"+w+"*/","TK_INLINE_COMMENT"]:["/*"+w+"*/","TK_BLOCK_COMMENT"]}if("/"===n.charAt(v)){for(w=x;"\r"!==n.charAt(v)&&"\n"!==n.charAt(v)&&(w+=n.charAt(v),v+=1,!(v>=y)););return[w,"TK_COMMENT"]}}if("`"===x||"'"===x||'"'===x||("/"===x||r.e4x&&"<"===x&&n.slice(v-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&("TK_RESERVED"===b.type&&e(b.text,["return","case","throw","else","do","typeof","yield"])||"TK_END_EXPR"===b.type&&")"===b.text&&b.parent&&"TK_RESERVED"===b.parent.type&&e(b.parent.text,["if","while","for"])||e(b.type,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var A=x,R=!1,O=!1;if(s=x,"/"===A)for(var K=!1;v<y&&(R||K||n.charAt(v)!==A)&&!o.newline.test(n.charAt(v));)s+=n.charAt(v),R?R=!1:(R="\\"===n.charAt(v),"["===n.charAt(v)?K=!0:"]"===n.charAt(v)&&(K=!1)),v+=1;else if(r.e4x&&"<"===A){var N=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,C=n.slice(v-1),D=N.exec(C);if(D&&0===D.index){for(var j=D[2],L=0;D;){var P=!!D[1],I=D[2],F=!!D[D.length-1]||"![CDATA["===I.slice(0,8);if(I!==j||F||(P?--L:++L),L<=0)break;D=N.exec(C)}var q=D?D.index+D[0].length:C.length;return v+=q-1,[C.slice(0,q),"TK_STRING"]}}else for(;v<y&&(R||n.charAt(v)!==A&&("`"===A||!o.newline.test(n.charAt(v))));)s+=n.charAt(v),R?("x"!==n.charAt(v)&&"u"!==n.charAt(v)||(O=!0),R=!1):R="\\"===n.charAt(v),v+=1;if(O&&r.unescape_strings&&(s=a(s)),v<y&&n.charAt(v)===A&&(s+=A,v+=1,"/"===A))for(;v<y&&o.isIdentifierStart(n.charCodeAt(v));)s+=n.charAt(v),v+=1;return[s,"TK_STRING"]}if("#"===x){if(0===_.length&&"!"===n.charAt(v)){for(s=x;v<y&&"\n"!==x;)x=n.charAt(v),s+=x,v+=1;return[t(s)+"\n","TK_UNKNOWN"]}var M="#";if(v<y&&c.test(n.charAt(v))){do x=n.charAt(v),M+=x,v+=1;while(v<y&&"#"!==x&&"="!==x);return"#"===x||("["===n.charAt(v)&&"]"===n.charAt(v+1)?(M+="[]",v+=2):"{"===n.charAt(v)&&"}"===n.charAt(v+1)&&(M+="{}",v+=2)),[M,"TK_WORD"]}}if("<"===x&&"<!--"===n.substring(v-1,v+3)){for(v+=3,x="<!--";"\n"!==n.charAt(v)&&v<y;)x+=n.charAt(v),v++;return d=!0,[x,"TK_COMMENT"]}if("-"===x&&d&&"-->"===n.substring(v-1,v+2))return d=!1,v+=2,["-->","TK_COMMENT"];if("."===x)return[x,"TK_DOT"];if(e(x,f)){for(;v<y&&e(x+n.charAt(v),f)&&(x+=n.charAt(v),v+=1,!(v>=y)););return","===x?[x,"TK_COMMA"]:"="===x?[x,"TK_EQUALS"]:[x,"TK_OPERATOR"]}return[x,"TK_UNKNOWN"]}function a(e){for(var t,n=!1,r="",i=0,s="",a=0;n||i<e.length;)if(t=e.charAt(i),i++,n){if(n=!1,"x"===t)s=e.substr(i,2),i+=2;else{if("u"!==t){r+="\\"+t;continue}s=e.substr(i,4),i+=4}if(!s.match(/^[0123456789abcdefABCDEF]+$/))return e;if(a=parseInt(s,16),a>=0&&a<32){r+="x"===t?"\\x"+s:"\\u"+s;continue}if(34===a||39===a||92===a)r+="\\"+String.fromCharCode(a);else{if("x"===t&&a>126&&a<=255)return e;r+=String.fromCharCode(a)}}else"\\"===t?n=!0:r+=t;return r}var u="\n\r\t ".split(""),c=/[0-9]/,f="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: => <%= <% %> <?= <? ?>".split(" ");this.line_starters="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,yield,import,export".split(",");var h,p,d,_,v,y,m=this.line_starters.concat(["do","in","else","get","set","new","catch","finally","typeof"]);this.tokenize=function(){y=n.length,v=0,d=!1,_=[];for(var e,t,r,i=null,a=[],o=[];!t||"TK_EOF"!==t.type;){for(r=s(),e=new l(r[1],r[0],h,p);"TK_INLINE_COMMENT"===e.type||"TK_COMMENT"===e.type||"TK_BLOCK_COMMENT"===e.type||"TK_UNKNOWN"===e.type;)o.push(e),r=s(),e=new l(r[1],r[0],h,p);o.length&&(e.comments_before=o,o=[]),"TK_START_BLOCK"===e.type||"TK_START_EXPR"===e.type?(e.parent=t,i=e,a.push(e)):("TK_END_BLOCK"===e.type||"TK_END_EXPR"===e.type)&&i&&("]"===e.text&&"["===i.text||")"===e.text&&"("===i.text||"}"===e.text&&"}"===i.text)&&(e.parent=i.parent,i=a.pop()),_.push(e),t=e}return _}}var o={};!function(e){var t="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",n="------------------------------------------------------------------------------------------------------------------------------------------",r=new RegExp("["+t+"]"),i=new RegExp("["+t+n+"]");e.newline=/[\n\r\u2028\u2029]/,e.isIdentifierStart=function(e){return e<65?36===e:e<91||(e<97?95===e:e<123||e>=170&&r.test(String.fromCharCode(e)))},e.isIdentifierChar=function(e){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||e>=170&&i.test(String.fromCharCode(e))))}}(o);var u={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},l=function(e,t,n,r,i,s){this.type=e,this.text=t,this.comments_before=[],this.newlines=n||0,this.wanted_newline=n>0,this.whitespace_before=r||"",this.parent=null};return{js_beautify:n}}),define("skylark-utils-js/beautify",["./js","./primitives/beautify-js"],function(e,t){return e.beautify=t.js_beautify}),define("skylark-utils-html/primitives/beautify-html",["skylark-utils-css/beautify","skylark-utils-js/beautify"],function(e,t){function n(e){return e.replace(/^\s+/g,"")}function r(e){return e.replace(/\s+$/g,"")}function i(e,t,i,s){function a(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=u,this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1}},this.is_whitespace=function(e){for(var t=0;t<e.length;e++)if(!this.Utils.in_array(e.charAt(t),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var e="";if(e=this.input.charAt(this.pos),this.Utils.in_array(e,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(e,this.Utils.whitespace);)d&&"\n"===e&&this.newlines<=_&&(this.newlines+=1),this.pos++,e=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(e){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,e),this.print_indentation(e)):(this.line_char_count++,e.push(" "))},this.get_content=function(){for(var e="",t=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(t);else{if(v){var n=this.input.substr(this.pos,3);if("{{#"===n||"{{/"===n)break;if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}e=this.input.charAt(this.pos),this.pos++,this.line_char_count++,t.push(e)}}return t.length?t.join(""):""},this.get_contents_to=function(e){if(this.pos===this.input.length)return["","TK_EOF"];var t="",n=new RegExp("</"+e+"\\s*>","igm");n.lastIndex=this.pos;var r=n.exec(this.input),i=r?r.index:this.input.length;return this.pos<i&&(t=this.input.substring(this.pos,i),this.pos=i),t},this.record_tag=function(e){this.tags[e+"count"]?(this.tags[e+"count"]++,this.tags[e+this.tags[e+"count"]]=this.indent_level):(this.tags[e+"count"]=1,this.tags[e+this.tags[e+"count"]]=this.indent_level),this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent,this.tags.parent=e+this.tags[e+"count"]},this.retrieve_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]],this.tags.parent=this.tags[t+"parent"]),delete this.tags[e+this.tags[e+"count"]+"parent"],delete this.tags[e+this.tags[e+"count"]],1===this.tags[e+"count"]?delete this.tags[e+"count"]:this.tags[e+"count"]--}},this.indent_to_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]])}},this.get_tag=function(e){var t,n,r,i="",s=[],a="",o=!1,u=this.pos,l=this.line_char_count;e=void 0!==e&&e;do{if(this.pos>=this.input.length)return e&&(this.pos=u,this.line_char_count=l),s.length?s.join(""):["","TK_EOF"];if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace))o=!0;else{if("'"!==i&&'"'!==i||(i+=this.get_unformatted(i),o=!0),"="===i&&(o=!1),s.length&&"="!==s[s.length-1]&&">"!==i&&o&&(this.space_or_wrap(s),o=!1),v&&"<"===r&&i+this.input.charAt(this.pos)==="{{"&&(i+=this.get_unformatted("}}"),s.length&&" "!==s[s.length-1]&&"<"!==s[s.length-1]&&(i=" "+i),o=!0),"<"!==i||r||(t=this.pos-1,r="<"),v&&!r&&s.length>=2&&"{"===s[s.length-1]&&"{"==s[s.length-2]&&(t="#"===i||"/"===i?this.pos-3:this.pos-2,r="{"),this.line_char_count++,s.push(i),s[1]&&"!"===s[1]){s=[this.get_comment(t)];break}if(v&&"{"===r&&s.length>2&&"}"===s[s.length-2]&&"}"===s[s.length-1])break}}while(">"!==i);var c,f,h=s.join("");c=h.indexOf(" ")!==-1?h.indexOf(" "):"{"===h[0]?h.indexOf("}"):h.indexOf(">"),f="<"!==h[0]&&v?"#"===h[2]?3:2:1;var d=h.substring(f,c).toLowerCase();return"/"===h.charAt(h.length-2)||this.Utils.in_array(d,this.Utils.single_token)?e||(this.tag_type="SINGLE"):v&&"{"===h[0]&&"else"===d?e||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(d,p)?(a=this.get_unformatted("</"+d+">",h),s.push(a),n=this.pos-1,this.tag_type="SINGLE"):"script"===d&&(h.search("type")===-1||h.search("type")>-1&&h.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?e||(this.record_tag(d),this.tag_type="SCRIPT"):"style"===d&&(h.search("type")===-1||h.search("type")>-1&&h.search("text/css")>-1)?e||(this.record_tag(d),this.tag_type="STYLE"):"!"===d.charAt(0)?e||(this.tag_type="SINGLE",this.traverse_whitespace()):e||("/"===d.charAt(0)?(this.retrieve_tag(d.substring(1)),this.tag_type="END"):(this.record_tag(d),"html"!==d.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(s),this.Utils.in_array(d,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),e&&(this.pos=u,this.line_char_count=l),s.join("")},this.get_comment=function(e){var t="",n=">",r=!1;for(this.pos=e,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&(t+=input_char,t[t.length-1]!==n[n.length-1]||t.indexOf(n)===-1);)!r&&t.length<10&&(0===t.indexOf("<![if")?(n="<![endif]>",r=!0):0===t.indexOf("<![cdata[")?(n="]]>",r=!0):0===t.indexOf("<![")?(n="]>",r=!0):0===t.indexOf("<!--")&&(n="-->",r=!0)),input_char=this.input.charAt(this.pos),this.pos++;return t},this.get_unformatted=function(e,t){if(t&&t.toLowerCase().indexOf(e)!==-1)return"";var n="",r="",i=0,s=!0;do{if(this.pos>=this.input.length)return r;if(n=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(n,this.Utils.whitespace)){if(!s){this.line_char_count--;continue}if("\n"===n||"\r"===n){r+="\n",this.line_char_count=0;continue}}r+=n,this.line_char_count++,s=!0,v&&"{"===n&&r.length&&"{"===r[r.length-2]&&(r+=this.get_unformatted("}}"),i=r.length)}while(r.toLowerCase().indexOf(e,i)===-1);return r},this.get_token=function(){var e;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var t=this.last_token.substr(7);return e=this.get_contents_to(t),"string"!=typeof e?e:[e,"TK_"+t]}if("CONTENT"===this.current_mode)return e=this.get_content(),"string"!=typeof e?e:[e,"TK_CONTENT"];if("TAG"===this.current_mode){if(e=this.get_tag(),"string"!=typeof e)return e;var n="TK_TAG_"+this.tag_type;return[e,n]}},this.get_full_indent=function(e){return e=this.indent_level+e||0,e<1?"":Array(e+1).join(this.indent_string)},this.is_unformatted=function(e,t){if(!this.Utils.in_array(e,t))return!1;if("a"!==e.toLowerCase()||!this.Utils.in_array("a",t))return!0;var n=this.get_tag(!0),r=(n||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!(r&&!this.Utils.in_array(r,t))},this.printer=function(e,t,i,s,a){this.input=e||"",this.output=[],this.indent_character=t,this.indent_string="",this.indent_size=i,this.brace_style=a,this.indent_level=0,this.wrap_line_length=s,this.line_char_count=0;for(var o=0;o<this.indent_size;o++)this.indent_string+=this.indent_character;this.print_newline=function(e,t){this.line_char_count=0,t&&t.length&&(e||"\n"!==t[t.length-1])&&("\n"!==t[t.length-1]&&(t[t.length-1]=r(t[t.length-1])),t.push("\n"))},this.print_indentation=function(e){for(var t=0;t<this.indent_level;t++)e.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(e){this.is_whitespace(e)&&!this.output.length||((e||""!==e)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),e=n(e)),this.print_token_raw(e))},this.print_token_raw=function(e){this.newlines>0&&(e=r(e)),e&&""!==e&&(e.length>1&&"\n"===e[e.length-1]?(this.output.push(e.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(e));for(var t=0;t<this.newlines;t++)this.print_newline(t>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var o,u,l,c,f,h,p,d,_,v,y;for(t=t||{},void 0!==t.wrap_line_length&&0!==parseInt(t.wrap_line_length,10)||void 0===t.max_char||0===parseInt(t.max_char,10)||(t.wrap_line_length=t.max_char),u=void 0!==t.indent_inner_html&&t.indent_inner_html,l=void 0===t.indent_size?4:parseInt(t.indent_size,10),c=void 0===t.indent_char?" ":t.indent_char,h=void 0===t.brace_style?"collapse":t.brace_style,f=0===parseInt(t.wrap_line_length,10)?32786:parseInt(t.wrap_line_length||250,10),p=t.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],d=void 0===t.preserve_newlines||t.preserve_newlines,_=d?isNaN(parseInt(t.max_preserve_newlines,10))?32786:parseInt(t.max_preserve_newlines,10):0,v=void 0!==t.indent_handlebars&&t.indent_handlebars,y=void 0!==t.end_with_newline&&t.end_with_newline,o=new a,o.printer(e,c,l,f,h);;){var m=o.get_token();if(o.token_text=m[0],o.token_type=m[1],"TK_EOF"===o.token_type)break;switch(o.token_type){case"TK_TAG_START":o.print_newline(!1,o.output),o.print_token(o.token_text),o.indent_content&&(o.indent(),o.indent_content=!1),o.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===o.last_token&&""===o.last_text){var g=o.token_text.match(/\w+/)[0],b=null;o.output.length&&(b=o.output[o.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),null!==b&&b[1]===g||o.print_newline(!1,o.output)}o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var x=o.token_text.match(/^\s*<([a-z-]+)/i);x&&o.Utils.in_array(x[1],p)||o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":o.print_token(o.token_text),o.indent_content&&(o.indent(),o.indent_content=!1),o.current_mode="CONTENT";break;case"TK_CONTENT":o.print_token(o.token_text),o.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==o.token_text){o.print_newline(!1,o.output);var E,T=o.token_text,k=1;"TK_SCRIPT"===o.token_type?E="function"==typeof i&&i:"TK_STYLE"===o.token_type&&(E="function"==typeof s&&s),"keep"===t.indent_scripts?k=0:"separate"===t.indent_scripts&&(k=-o.indent_level);var w=o.get_full_indent(k);if(E)T=E(T.replace(/^\s*/,w),t);else{var S=T.match(/^\s*/)[0],A=S.match(/[^\n\r]*$/)[0].split(o.indent_string).length-1,R=o.get_full_indent(k-A);T=T.replace(/^\s*/,w).replace(/\r\n|\r|\n/g,"\n"+R).replace(/\s+$/,"")}T&&(o.print_token_raw(T),o.print_newline(!0,o.output))}o.current_mode="TAG";break;default:""!==o.token_text&&o.print_token(o.token_text)}o.last_token=o.token_type,o.last_text=o.token_text}var O=o.output.join("").replace(/[\r\n\t ]+$/,"");return y&&(O+="\n"),O}return{html_beautify:function(t,n){return i(t,n,beautifyJs,e)}}}),define("skylark-utils-html/beautify",["./html","./primitives/beautify-html"],function(e,t){return e.beautify=t.html_beautify}),define("skylark-utils-html/main",["./html","./beautify"],function(e){return e}),define("skylark-utils-html",["skylark-utils-html/main"],function(e){return e})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-html-all.js.map
